#ifndef matbas_dist_h
#define matbas_dist_h

#define DIST "import*as us from\"dotenv\";import{Injectable as rt,Inject as Et,Module as fs}from\"@nestjs/common\";import{NestFactory as ps}from\"@nestjs/core\";import*as ms from\"node:process\";import ds,{stdin as gs,stdout as ws,stderr as vs}from\"node:process\";import{inspect as It}from\"node:util\";import Ot from\"ansi-colors\";import{readFile as bs,writeFile as ys}from\"node:fs/promises\";import*as nt from\"node:path\";import{basename as ce}from\"node:path\";import*as at from\"node:os\";import{spawnSync as Es,spawn as he}from\"node:child_process\";import{trace as le,context as ue}from\"@opentelemetry/api\";import Is from\"text-table\";import*as xs from\"node:readline/promises\";import*as xt from\"node:assert\";import K from\"strftime\";var k=function(s){return s.Access=\"EACCES\",s.AddressInUse=\"EADDRINUSE\",s.ConnectionRefused=\"ECONNREFUSED\",s.ConnectionReset=\"ECONNRESET\",s.Exists=\"EEXIST\",s.IsDirectory=\"EISDIR\",s.MaxFileDescriptors=\"EMFILE\",s.NoEntity=\"ENOENT\",s.NotADirectory=\"ENOTDIR\",s.NotEmpty=\"ENOTEMPTY\",s.DnsNotFound=\"ENOTFOUND\",s.NotPermitted=\"EPERM\",s.BrokenPipe=\"EPIPE\",s.TimedOut=\"ETIMEDOUT\",s.Assertion=\"ERR_ASSERTION\",s}({});function g(s){return function(t){return t.prototype.name=s,t}}function ks(s,t,e,i){var r=arguments.length,n=r<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i,o;if(typeof Reflect==\"object\"&&typeof Reflect.decorate==\"function\")n=Reflect.decorate(s,t,e,i);else for(var c=s.length-1;c>=0;c--)(o=s[c])&&(n=(r<3?o(n):r>3?o(t,e,n):o(t,e))||n);return r>3&&n&&Object.defineProperty(t,e,n),n}function fe(s,t){if(typeof Reflect==\"object\"&&typeof Reflect.metadata==\"function\")return Reflect.metadata(s,t)}var v=function(s){return s[s.Success=0]=\"Success\",s[s.Usage=64]=\"Usage\",s[s.DataError=65]=\"DataError\",s[s.NoInput=66]=\"NoInput\",s[s.NoUser=67]=\"NoUser\",s[s.NoHost=68]=\"NoHost\",s[s.Unavailable=69]=\"Unavailable\",s[s.Software=70]=\"Software\",s[s.OsError=71]=\"OsError\",s[s.OsFile=72]=\"OsFile\",s[s.CantCreate=73]=\"CantCreate\",s[s.IoError=74]=\"IoError\",s[s.TempFail=75]=\"TempFail\",s[s.Protocol=76]=\"Protocol\",s[s.NoPermission=77]=\"NoPermission\",s[s.Config=78]=\"Config\",s}({});let W=class extends Error{exitCode;constructor(t=0,e=\"\"){super(e),this.exitCode=t,Object.setPrototypeOf(this,new.target.prototype)}format(t){return t.formatExit(this)}};W=ks([g(\"Exit\"),fe(\"design:type\",Function),fe(\"design:paramtypes\",[Object,String])],W);const Bt={version:\"0.0.1\"},Ft={matbas:\"0.0.1\",swc:\"1.7.26\"};class N{}class pe extends N{op;expr;constructor(t,e){super(),this.op=t,this.expr=e}accept(t){return t.visitUnaryExpr(this)}}class tt extends N{left;op;right;constructor(t,e,i){super(),this.left=t,this.op=e,this.right=i}accept(t){return t.visitBinaryExpr(this)}}class me extends N{left;op;right;constructor(t,e,i){super(),this.left=t,this.op=e,this.right=i}accept(t){return t.visitLogicalExpr(this)}}class Ss extends N{expr;constructor(t){super(),this.expr=t}accept(t){return t.visitGroupExpr(this)}}class Ls extends N{ident;constructor(t){super(),this.ident=t}accept(t){return t.visitVariableExpr(this)}}class jt extends N{value;constructor(t){super(),this.value=t}accept(t){return t.visitIntLiteralExpr(this)}}class Ns extends N{value;constructor(t){super(),this.value=t}accept(t){return t.visitRealLiteralExpr(this)}}class de extends N{value;constructor(t){super(),this.value=t}accept(t){return t.visitBoolLiteralExpr(this)}}class Rs extends N{value;constructor(t){super(),this.value=t}accept(t){return t.visitStringLiteralExpr(this)}}class _s extends N{value;constructor(t){super(),this.value=t}accept(t){return t.visitShellLiteralExpr(this)}}class $s extends N{value;constructor(t){super(),this.value=t}accept(t){return t.visitPromptLiteralExpr(this)}}class Ps extends N{constructor(){super()}accept(t){return t.visitNilLiteralExpr(this)}}class w{offsetStart;offsetEnd;constructor(t=-1,e=-1){this.offsetStart=t,this.offsetEnd=e}}class At extends w{remark;constructor(t,e=-1,i=-1){super(e,i),this.remark=t}accept(t){return t.visitRemInstr(this)}}class Os extends w{variable;value;constructor(t,e,i=-1,r=-1){super(i,r),this.variable=t,this.value=e}accept(t){return t.visitLetInstr(this)}}class Bs extends w{variable;value;constructor(t,e,i=-1,r=-1){super(i,r),this.variable=t,this.value=e}accept(t){return t.visitAssignInstr(this)}}class Fs extends w{expression;constructor(t,e=-1,i=-1){super(e,i),this.expression=t}accept(t){return t.visitExpressionInstr(this)}}class js extends w{expression;constructor(t,e=-1,i=-1){super(e,i),this.expression=t}accept(t){return t.visitPrintInstr(this)}}class ge extends w{expression;constructor(t,e=-1,i=-1){super(e,i),this.expression=t}accept(t){return t.visitExitInstr(this)}}class As extends w{constructor(t=-1,e=-1){super(t,e)}accept(t){return t.visitEndInstr(this)}}class Ws extends w{filename;constructor(t,e=-1,i=-1){super(e,i),this.filename=t}accept(t){return t.visitNewInstr(this)}}class Ts extends w{params;constructor(t,e=-1,i=-1){super(e,i),this.params=t}accept(t){return t.visitLoadInstr(this)}}class Wt extends w{lineStart;lineEnd;constructor(t,e,i=-1,r=-1){super(i,r),this.lineStart=t,this.lineEnd=e}accept(t){return t.visitListInstr(this)}}class Ds extends w{constructor(t=-1,e=-1){super(t,e)}accept(t){return t.visitRenumInstr(this)}}class Us extends w{constructor(t=-1,e=-1){super(t,e)}accept(t){return t.visitRunInstr(this)}}class Js extends w{filename;constructor(t,e=-1,i=-1){super(e,i),this.filename=t}accept(t){return t.visitSaveInstr(this)}}class Gs extends w{condition;then;else_;constructor(t,e,i,r=-1,n=-1){super(r,n),this.condition=t,this.then=e,this.else_=i}accept(t){return t.visitShortIfInstr(this)}}class Cs extends w{condition;constructor(t,e=-1,i=-1){super(e,i),this.condition=t}accept(t){return t.visitIfInstr(this)}}class zs extends w{constructor(t=-1,e=-1){super(t,e)}accept(t){return t.visitElseInstr(this)}}class Hs extends w{condition;constructor(t,e=-1,i=-1){super(e,i),this.condition=t}accept(t){return t.visitElseIfInstr(this)}}class Ms extends w{constructor(t=-1,e=-1){super(t,e)}accept(t){return t.visitEndIfInstr(this)}}class qs extends w{variable;value;stop;step;constructor(t,e,i,r,n=-1,o=-1){super(n,o),this.variable=t,this.value=e,this.stop=i,this.step=r}accept(t){return t.visitForInstr(this)}}class Vs extends w{constructor(t=-1,e=-1){super(t,e)}accept(t){return t.visitOnwardInstr(this)}}class Zs extends w{constructor(t=-1,e=-1){super(t,e)}accept(t){return t.visitNextInstr(this)}}class Xs extends w{condition;constructor(t,e=-1,i=-1){super(e,i),this.condition=t}accept(t){return t.visitWhileInstr(this)}}class Ys extends w{constructor(t=-1,e=-1){super(t,e)}accept(t){return t.visitEndWhileInstr(this)}}class Qs extends w{constructor(t=-1,e=-1){super(t,e)}accept(t){return t.visitRepeatInstr(this)}}class Ks extends w{condition;constructor(t,e=-1,i=-1){super(e,i),this.condition=t}accept(t){return t.visitUntilInstr(this)}}class ti extends w{name;params;constructor(t,e,i=-1,r=-1){super(i,r),this.name=t,this.params=e}accept(t){return t.visitCommandInstr(this)}}class ot{}class ei extends ot{cmdNo;row;source;instructions;constructor(t,e,i,r){super(),this.cmdNo=t,this.row=e,this.source=i,this.instructions=r}accept(t){return t.visitCmdTree(this)}}class Tt extends ot{lineNo;row;source;instructions;constructor(t,e,i,r){super(),this.lineNo=t,this.row=e,this.source=i,this.instructions=r}accept(t){return t.visitLineTree(this)}}class si extends ot{input;constructor(t){super(),this.input=t}accept(t){return t.visitInputTree(this)}}class Dt extends ot{filename;lines;constructor(t,e){super(),this.filename=t,this.lines=e}accept(t){return t.visitProgramTree(this)}}function F(s,t){let e=\"\";for(let i=0;i<s;i++)e+=\"  \";return t.split(`\n`).map(i=>i.length?`${e}${i}`:\"\").join(`\n`)}class ii{format(t){return typeof t==\"string\"?this.formatString(t):typeof t==\"number\"?this.formatNumber(t):typeof t==\"boolean\"?this.formatBoolean(t):t instanceof N?this.formatExpr(t):t instanceof w?this.formatInstr(t):t instanceof ot?this.formatTree(t):t&&t.format?t.format(this):Array.isArray(t)?this.formatArray(t):this.formatAny(t)}}function V(s,t={colors:!1}){let e;return s.includes(\"'\")?s.includes('\"')?e=`'${s.replace(/'/g,\"\\\\'\")}'`:e=`\"${s}\"`:e=`'${s}'`,t.colors&&(e=Ot.green(e)),e}function we(s,t,e={colors:!1}){let i=`[\n`;for(let r=0;r<s.length;r++)typeof s[r]==\"string\"?i+=F(1,V(s[r],e)):i+=F(1,t.format(s[r])),i+=`,\n`;return i+=\"]\",i}class Ut extends ii{constructor(){super()}formatString(t){return t}formatNumber(t){return String(t)}formatBoolean(t){return String(t)}formatTraceback(t){let e=\"\",i=t;for(i&&(e+=`Traceback:\n`);i;)e+=`  File ${V(i.filename)}, line ${i.lineNo}`,i=i.next;return e}formatBaseException(t){let e=\"\";return t.traceback&&(e+=this.format(t.traceback),e+=`\n`),e+=`${t.constructor.name}: ${t.message}`,e}formatBaseWarning(t){let e=\"\";return t.traceback?e+=`${t.traceback.filename}:${t.traceback.lineNo}`:e+=\"<unknown>:<?>\",e+=`: ${t.constructor.name}: ${t.message}`,e}formatAssertionError(t){return this.formatBaseException(t)}formatTypeError(t){let e=\"\";return t.traceback&&(e+=this.format(t.traceback),e+=`\n`),e+=`${t.constructor.name}: ${t.message}\n`,e+=`  Value: ${this.format(t.value)}\n`,e+=`  From: ${t.from}\n`,e+=`  To: ${t.to}`,e}formatZeroDivisionError(t){let e=\"\";return t.traceback&&(e+=this.format(t.traceback),e+=`\n`),e+=`${t.constructor.name}: Cannot divide `+S.format(t.a)+\" by \"+S.format(t.b),e}formatOsError(t){let e=\"\";return t.traceback&&(e+=this.format(t.traceback),e+=`\n`),e+=`${t.constructor.name} ${t.code}: ${t.message}`,e}formatFileError(t){let e=\"\";return t.traceback&&(e+=this.format(t.traceback),e+=`\n`),e+=`${t.constructor.name} ${t.code}: ${t.message}\n`,t.paths.length==2?(e+=`  Source File: ${t.paths[0]}\n`,e+=`  Destination File: ${t.paths[1]}`):e+=`  Input File: ${t.paths[0]}`,e}formatSyntaxIssue(t,e,i){let r,n=\"\";i.isLine?r=String(i.lineNo):(i.cmdNo?r=`command ${i.cmdNo}`:r=`<R${i.row}>`,i.lineNo&&i.lineNo>0?n=` (after line ${i.lineNo})`:n=\" (at the beginning)\");let o=`${i.filename}:${r}:${i.offsetStart}${n}: ${t}: ${e}\n`;o+=`  ${i.source}\n`;for(let c=0;c<=i.offsetStart+1;c++)o+=\" \";return o+=\"^\",o}formatSyntaxError(t){return this.formatSyntaxIssue(\"error\",this.format(t.message),t)}formatParseError(t){return t.errors.map(e=>this.format(e)).join(`\n`)}formatSyntaxWarning(t){return this.formatSyntaxIssue(\"warning\",this.format(t.message),t)}formatParseWarning(t){return t.warnings.map(e=>this.format(e)).join(`\n`)}formatBaseFault(t){let e=`=== INTERNAL FAULT ===\n\n`;return e+=`--- Internal Stack Trace ---\n`,e+=t.stack,e}formatRuntimeFault(t){let e=`=== RUNTIME FAULT ===\n\n`;return e+=`--- Internal Stack Trace ---\n`,e+=t.error.stack,t.traceback&&(e+=`\n\n--- Traceback ---\n`,e+=this.format(t.traceback)),e+=`\n\n--- Versions ---\n`,e+=`Matanuska BASIC: v${Ft.matbas}\n`,e+=`swc: v${Ft.swc}\n`,e+=`vite: v${Ft.swc}\n`,e+=`Node.js: ${ds.version}\n\n`,e+=`This is a bug in Matanuska BASIC. If you copy this entire message and post it\n`,e+=`to the issues tracker:\n\n`,e+=`    https://github.com/jfhbrook/matanuska/issues\n\n`,e+=`the developers will do their best to fix it - and more importantly, they will\n`,e+=`owe you a beer, coffee or beverage of your choice. \\u{1F37B}\n\n`,e}formatUsageFault(t){return t.message}formatExit(t){return`Exit ${t.exitCode}${t.message.length?\": \"+t.message:\"\"}`}visitCmdTree(t){return this.formatArray(t.instructions)}visitLineTree(t){let e=`Line(${t.lineNo}) [\n`;const i=[];for(const r of t.instructions)i.push(this.format(r));for(const r of i)e+=F(1,`${r},\n`);return e+=\"]\",e}visitInputTree(t){let e=`Input(\n`;return e+=F(1,this.format(t.input)),e+=`\n)`,e}visitProgramTree(t){let e=`Program(\n`;const i=[];for(const r of t.lines)i.push(F(1,this.format(r)));for(const r of i)e+=`${r},\n`;return e+=\")\",e}formatExpr(t){return t.accept(this)}formatInstr(t){return t.accept(this)}formatTree(t){return t.accept(this)}formatToken(t){let e=`Token(${t.kind}) {\n`;if(e+=`  index: ${t.index},\n`,e+=`  row: ${t.row},\n`,e+=`  offsetStart: ${t.offsetStart},\n`,e+=`  offsetEnd: ${t.offsetEnd},\n`,e+=`  text: ${V(t.text)},\n`,t.value){const i=typeof t.value==\"string\"?V(t.value):t.value;e+=`  value: ${i},\n`}return e+=\"}\",e}visitBinaryExpr(t){let e=`Binary(${t.op}) {\n`;return e+=F(1,`${this.format(t.left)},\n`),e+=F(1,`${this.format(t.right)},\n`),e+=\"}\",e}visitLogicalExpr(t){let e=`Logical(${t.op} {\n`;return e+=F(1,`${this.format(t.left)},\n`),e+=F(1,`${this.format(t.right)},\n`),e+=\"}\",e}visitUnaryExpr(t){let e=`Unary(${t.op}) {\n`;return e+=F(1,`${this.format(t.expr)},\n`),e+=\"}\",e}visitGroupExpr(t){return`(${this.format(t.expr)})`}visitVariableExpr(t){return t.ident.text}visitIntLiteralExpr(t){return String(t.value)}visitRealLiteralExpr(t){return String(t.value)}visitBoolLiteralExpr(t){return String(t.value)}visitStringLiteralExpr(t){return V(t.value)}visitShellLiteralExpr(t){return t.value}visitPromptLiteralExpr(t){return V(t.value)}visitNilLiteralExpr(t){return\"nil\"}visitExpressionInstr(t){return`Expression(${this.format(t.expression)})`}visitPrintInstr(t){return`Print(${this.format(t.expression)})`}visitRemInstr(t){return`Rem(${t.remark})`}visitNewInstr(t){return`New(${this.format(t.filename)})`}visitLoadInstr(t){return`Load (${this.formatArgv(t.params)})`}visitListInstr(t){let e=\"List(\";return t.lineStart&&(e+=t.lineStart),t.lineEnd&&(e+=`, ${t.lineEnd}`),e+=\")\",e}visitRenumInstr(t){return\"Renum\"}visitSaveInstr(t){return`New(${this.format(t.filename)})`}visitRunInstr(t){return\"Run\"}visitEndInstr(t){return\"End\"}visitExitInstr(t){return`Exit(${this.format(t.expression)})`}visitLetInstr(t){return`Let(${this.format(t.variable)}, ${this.format(t.value)})`}visitAssignInstr(t){return`Assign(${this.format(t.variable)}, ${this.format(t.value)})`}visitShortIfInstr(t){let e=`ShortIf (${this.format(t.condition)}) { `;return e+=t.then.map(i=>this.format(i)).join(\" : \")+\" }\",t.else_.length&&(e+=\" { \"+t.else_.map(i=>this.format(i)).join(\" : \")+\" }\"),e}visitIfInstr(t){return`If (${this.format(t.condition)})`}visitElseInstr(t){return\"Else\"}visitElseIfInstr(t){return`ElseIf (${this.format(t.condition)})`}visitEndIfInstr(t){return\"EndIf\"}visitForInstr(t){return`For(${this.format(t.variable)}, ${this.format(t.value)})`}visitOnwardInstr(t){return\"Onward\"}visitNextInstr(t){return\"Next\"}visitWhileInstr(t){return`While (${this.format(t.condition)})`}visitEndWhileInstr(t){return\"EndWhile\"}visitRepeatInstr(t){return\"Repeat\"}visitUntilInstr(t){return`Until (${this.format(t.condition)})`}formatArgv(t,e=!1){return t.map(i=>e&&i instanceof jt?\"0\"+i.value.toString(8):this.format(i)).join(\" \")}visitCommandInstr(t){return`Command (${this.format(t.name)}, ${this.formatArgv(t.params)})`}formatStack(t){let e=\"{ \";for(const i of t.stack)e+=this.format(i),e+=\", \";return e+\"}\"}formatArray(t){return we(t,this)}formatAny(t){return It(t)}}const S=new Ut;class ri extends Ut{colors=!0;formatString(t){return V(t,this)}formatNumber(t){return It(t,this)}formatBoolean(t){return It(t,this)}formatTraceback(t){return S.format(t)}inspectException(t){return S.format(t)}inspectFault(t){return S.format(t)}formatBaseException(t){return this.inspectException(t)}formatBaseWarning(t){return this.inspectException(t)}formatOsError(t){return this.inspectException(t)}formatFileError(t){return this.inspectException(t)}formatSyntaxError(t){return this.inspectException(t)}formatParseError(t){return this.inspectException(t)}formatSyntaxWarning(t){return this.inspectException(t)}formatParseWarning(t){return this.inspectException(t)}formatBaseFault(t){return this.inspectFault(t)}formatRuntimeFault(t){return this.inspectFault(t)}formatUsageFault(t){return this.inspectFault(t)}formatExit(t){let e=String(t.exitCode);return t.exitCode?e=Ot.red(e):e=Ot.green(e),`Exit ${e}${t.message.length?\": \"+t.message:\"\"}`}formatArray(t){return we(t,this,this)}formatAny(t){return It(t,this)}}const ni=new ri;function I(s,t,e,i){var r=arguments.length,n=r<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i,o;if(typeof Reflect==\"object\"&&typeof Reflect.decorate==\"function\")n=Reflect.decorate(s,t,e,i);else for(var c=s.length-1;c>=0;c--)(o=s[c])&&(n=(r<3?o(n):r>3?o(t,e,n):o(t,e))||n);return r>3&&n&&Object.defineProperty(t,e,n),n}function L(s,t){if(typeof Reflect==\"object\"&&typeof Reflect.metadata==\"function\")return Reflect.metadata(s,t)}class T extends Error{message;traceback;constructor(t,e=null){const i=typeof t==\"string\"?t:S.format(t);super(i),this.message=t,this.traceback=e,Object.setPrototypeOf(this,new.target.prototype)}format(t){return t.formatBaseException(this)}}T=I([g(\"BaseException\"),L(\"design:type\",Function),L(\"design:paramtypes\",[Object,Object])],T);class j extends T{}j=I([g(\"Exception\")],j);class ve extends j{format(t){return t.formatAssertionError(this)}}ve=I([g(\"AssertionError\")],ve);class O extends j{}O=I([g(\"RuntimeError\")],O);class D extends O{message;value;traceback;from;to;constructor(t,e,i,r,n=null){super(t,n),this.message=t,this.value=e,this.traceback=n,this.from=i,this.to=r}format(t){return t.formatTypeError(this)}}D=I([g(\"TypeError\"),L(\"design:type\",Function),L(\"design:paramtypes\",[Object,typeof Value>\"u\"?Object:Value,String,String,Object])],D);class ct extends O{}ct=I([g(\"ValueError\")],ct);class ht extends O{}ht=I([g(\"NameError\")],ht);class Z extends O{}Z=I([g(\"ParamError\")],Z);class Jt extends O{}Jt=I([g(\"ArithmeticError\")],Jt);class Gt extends Jt{a;typeA;b;typeB;traceback;constructor(t,e,i,r,n=null){super(\"Cannot divide by zero\",n),this.a=t,this.typeA=e,this.b=i,this.typeB=r,this.traceback=n,Object.setPrototypeOf(this,new.target.prototype)}format(t){return t.formatZeroDivisionError(this)}}Gt=I([g(\"ZeroDivisionError\"),L(\"design:type\",Function),L(\"design:paramtypes\",[typeof Value>\"u\"?Object:Value,String,typeof Value>\"u\"?Object:Value,String,Object])],Gt);class Ct extends O{}Ct=I([g(\"NotImplementedError\")],Ct);class kt extends T{format(t){return t.formatBaseWarning(this)}}kt=I([g(\"BaseWarning\")],kt);class zt extends kt{}zt=I([g(\"Warning\")],zt);class be extends zt{}be=I([g(\"DeprecationWarning\")],be);class Ht extends j{message;code;traceback;exitCode;constructor(t,e,i,r){if(super(t,r),this.message=t,this.code=e,this.traceback=r,Object.setPrototypeOf(this,new.target.prototype),i)this.exitCode=i;else switch(e){case k.Access:this.exitCode=v.OsError;break;case k.AddressInUse:this.exitCode=v.Protocol;break;case k.ConnectionRefused:case k.ConnectionReset:this.exitCode=v.Unavailable;break;case k.Exists:this.exitCode=v.CantCreate;break;case k.IsDirectory:this.exitCode=v.IoError;break;case k.MaxFileDescriptors:this.exitCode=v.OsError;break;case k.NoEntity:this.exitCode=v.NoInput;break;case k.NotADirectory:this.exitCode=v.NoInput;break;case k.NotEmpty:this.exitCode=v.OsError;break;case k.DnsNotFound:this.exitCode=v.NoHost;break;case k.NotPermitted:this.exitCode=v.NoPermission;break;case k.BrokenPipe:this.exitCode=v.OsError;break;case k.TimedOut:this.exitCode=v.Unavailable;break;default:this.exitCode=v.OsError}}format(t){return t.formatOsError(this)}}Ht=I([g(\"OsError\"),L(\"design:type\",Function),L(\"design:paramtypes\",[Object,Object,Object,Object])],Ht);function Mt(s){const t=s.message.split(\": \");return t.length===2?t[1]:s.message}class G extends Ht{message;code;paths;traceback;constructor(t,e,i,r,n){super(t,e,i,n),this.message=t,this.code=e,this.paths=r,this.traceback=n,Object.setPrototypeOf(this,new.target.prototype)}static fromError(t,e,i=null){const r=t||Mt(e);return new G(r,e.code||\"<unknown>\",null,[e.path||\"<unknown>\"],i)}static fromReadError(t,e,i=null){const r=t||Mt(e),n=e.code;let o=null;return n==k.Access&&(o=v.NoInput),new G(r,n||\"<unknown>\",o,[e.path||\"<unknown>\"],i)}static fromWriteError(t,e,i=null){const r=t||Mt(e),n=e.code;let o=null;return n==k.Access&&(o=v.CantCreate),new G(r,n||\"<unknown>\",o,[e.path||\"<unknown>\"],i)}format(t){return t.formatFileError(this)}}G=I([g(\"FileError\"),L(\"design:type\",Function),L(\"design:paramtypes\",[Object,Object,Object,typeof FileErrorPaths>\"u\"?Object:FileErrorPaths,Object])],G);function ye(s){return function(e,i){for(const r of s){const n=e[r]===null?-1:e[r],o=i[r]===null?-1:i[r],c=n-o;if(c)return c}return 0}}class lt extends T{filename;row;isLine;lineNo;cmdNo;offsetStart;offsetEnd;source;constructor(t,e){super(t,null),Object.setPrototypeOf(this,new.target.prototype),Object.assign(this,e)}format(t){return t.formatSyntaxError(this)}}lt=I([g(\"SyntaxError\"),L(\"design:type\",Function),L(\"design:paramtypes\",[Object,typeof SourceLocation>\"u\"?Object:SourceLocation])],lt);class R extends j{errors;exitCode=v.Software;constructor(t){super(\"\",null),this.errors=t,Object.setPrototypeOf(this,new.target.prototype)}sort(t){this.errors.sort(ye(t))}format(t){return t.formatParseError(this)}}class St extends kt{filename;row;isLine;lineNo;cmdNo;offsetStart;offsetEnd;source;constructor(t,e){super(t,null),Object.setPrototypeOf(this,new.target.prototype),Object.assign(this,e)}format(t){return t.formatSyntaxWarning(this)}}St=I([g(\"SyntaxWarning\"),L(\"design:type\",Function),L(\"design:paramtypes\",[Object,typeof SourceLocation>\"u\"?Object:SourceLocation])],St);class U extends j{warnings;constructor(t){super(\"\",null),this.warnings=t,Object.setPrototypeOf(this,new.target.prototype)}sort(t){this.warnings.sort(ye(t))}format(t){return t.formatParseWarning(this)}}U=I([g(\"ParseWarning\"),L(\"design:type\",Function),L(\"design:paramtypes\",[typeof Array>\"u\"?Object:Array])],U);function Ee(s,t,e){let i=0,r=0;const n=[];for(;;){if(i>=s.length)return n.concat(t.slice(r));if(r>=t.length)return n.concat(s.slice(i));for(const o of e){const c=typeof s[i][o]==\"number\"?s[i][o]:-1,u=typeof t[r][o]==\"number\"?t[r][o]:-1;if(c<u){n.push(s[i++]);break}if(c>u){n.push(t[r++]);break}}}}function et(s,t=[\"lineNo\",\"row\",\"offsetStart\"]){let e=!1,i=!1,r=[];for(const n of s)n instanceof R?(e=!0,r=Ee(r,n.errors,t)):n instanceof U&&(i=!0,r=Ee(r,n.warnings,t));return e?new R(r):i?new U(r):null}function ai(s,t){const e={},i={};function r(n){for(const o of n)i[o[t]]||(i[o[t]]=[]),o instanceof R&&(e[o[t]]=!0),i[o[t]].push(o)}if(s instanceof R)r(s.errors);else if(s instanceof U)r(s.warnings);else if(s===null)return{};return Object.fromEntries(Object.entries(i).map(([n,o])=>{let c;return e[n]?c=new R(o):c=new U(o),[n,c]}))}function oi(s,t,e){let i=[];if(s===null)return null;s instanceof R?i=s.errors:i=s.warnings;let r=!1;return i=i.filter(n=>n[t]===e?!1:(n instanceof lt&&(r=!0),!0)),r?new R(i):new U(i)}function Ie(s,t){s&&s.sort(t)}function ut(s,t,e,i){var r=arguments.length,n=r<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i,o;if(typeof Reflect==\"object\"&&typeof Reflect.decorate==\"function\")n=Reflect.decorate(s,t,e,i);else for(var c=s.length-1;c>=0;c--)(o=s[c])&&(n=(r<3?o(n):r>3?o(t,e,n):o(t,e))||n);return r>3&&n&&Object.defineProperty(t,e,n),n}function C(s,t){if(typeof Reflect==\"object\"&&typeof Reflect.metadata==\"function\")return Reflect.metadata(s,t)}class ft extends Error{traceback;constructor(t,e=null){super(S.format(t)),this.traceback=e,Object.setPrototypeOf(this,new.target.prototype)}format(t){return t.formatBaseFault(this)}}ft=ut([g(\"BaseFault\"),C(\"design:type\",Function),C(\"design:paramtypes\",[Object,Object])],ft);class Lt extends ft{}Lt=ut([g(\"Fault\")],Lt);class x extends Lt{error;exitCode=v.Software;constructor(t,e,i=null){super(t,i),this.error=e,Object.setPrototypeOf(this,new.target.prototype)}static fromError(t,e=null){let i=\"Unspecified error\";if(typeof t.message>\"u\")if(t.format)try{i=S.format(t)}catch(r){i=String(r)}else i=String(t);else if(typeof t.message==\"string\")i=t.message;else if(t.format)try{i=S.format(t.message)}catch(r){i=String(r.message)}else i=String(t.message);return t instanceof Error||(t=new Error(i)),new x(i,t,e)}static fromException(t){return new x(t.message,new Error(`Uncaught ${t.constructor.name}: ${t.message}`),t.traceback)}format(t){return t.formatRuntimeFault(this)}}x=ut([g(\"RuntimeFault\"),C(\"design:type\",Function),C(\"design:paramtypes\",[Object,typeof Error>\"u\"?Object:Error,Object])],x);class xe extends x{constructor(t,e=null){super(t,new Error,e),Object.setPrototypeOf(this,new.target.prototype),this.error=this}}xe=ut([g(\"NotImplementedFault\"),C(\"design:type\",Function),C(\"design:paramtypes\",[Object,Object])],xe);class Nt extends Lt{exitCode=v.Usage;constructor(t){super(t,null),Object.setPrototypeOf(this,new.target.prototype)}format(t){return t.formatUsageFault(this)}}Nt=ut([g(\"UsageFault\"),C(\"design:type\",Function),C(\"design:paramtypes\",[String])],Nt);function qt(s,t,e){const i=e.value,r=function(...o){try{return i.apply(this,o)}catch(c){throw c instanceof j||c instanceof ft?c:x.fromError(c,null)}};e.value=r}var h=function(s){return s.Integer=\"integer\",s.Real=\"real\",s.Boolean=\"boolean\",s.String=\"string\",s.Exception=\"Exception\",s.Nil=\"nil\",s.Undef=\"undef\",s.Any=\"any\",s.Unknown=\"unknown\",s.Invalid=\"invalid\",s}({});function ke(s){return!(!s||s.match(/^\\W*$/)||s.match(/^\\W*0\\W*$/)||s.match(/^\\W*false\\W*$/i))}function Se(s){return[s>>8&255,s&255]}function Le([s,t]){return s<<8|t}var l=function(s){return s[s.Constant=0]=\"Constant\",s[s.Nil=1]=\"Nil\",s[s.Undef=2]=\"Undef\",s[s.True=3]=\"True\",s[s.False=4]=\"False\",s[s.Pop=5]=\"Pop\",s[s.GetLocal=6]=\"GetLocal\",s[s.SetLocal=7]=\"SetLocal\",s[s.GetGlobal=8]=\"GetGlobal\",s[s.DefineGlobal=9]=\"DefineGlobal\",s[s.SetGlobal=10]=\"SetGlobal\",s[s.Eq=11]=\"Eq\",s[s.Gt=12]=\"Gt\",s[s.Ge=13]=\"Ge\",s[s.Lt=14]=\"Lt\",s[s.Le=15]=\"Le\",s[s.Ne=16]=\"Ne\",s[s.Not=17]=\"Not\",s[s.Add=18]=\"Add\",s[s.Sub=19]=\"Sub\",s[s.Mul=20]=\"Mul\",s[s.Div=21]=\"Div\",s[s.Neg=22]=\"Neg\",s[s.Print=23]=\"Print\",s[s.Exit=24]=\"Exit\",s[s.Command=25]=\"Command\",s[s.Jump=26]=\"Jump\",s[s.JumpIfFalse=27]=\"JumpIfFalse\",s[s.Loop=28]=\"Loop\",s[s.Return=29]=\"Return\",s}({});function ci(s){return s.filename}function hi(s){return typeof s>\"u\"?\"<undefined>\":`0x${s.toString(16)}`}function li(s){const t=[],e=`=== Disassembly of ${ci(s)}: ===`;let i=0,r;for(;i<s.code.length;)[i,r]=fi(s,i),t.push(r);return`${e}\n${Is(t)}`}const Ne=1,ui=-1;function fi(s,t){let e=0,i=255,r;function n(d=1){return t+=d,i=s.code[t-1],e=s.lines[t-1],i}function o(d=0){return s.code[t+d-1]}function c(d){return[String(e),String(t),d,\"\"]}function u(d){return[String(e),String(t),d,String(n())]}function m(d){return[String(e),String(t),d,S.format(s.constants[n()])]}function p(d){return[String(e),String(t),d,String(n())]}function E(d,f){const $=Le([o(1),o(2)]),P=[String(e),String(t),d,`${t} -> ${t+3+f*$}`];return n(2),P}switch(n()){case l.Constant:r=m(\"CONSTANT\");break;case l.Nil:r=c(\"NIL\");break;case l.Undef:r=c(\"UNDEF\");break;case l.True:r=c(\"TRUE\");break;case l.False:r=c(\"FALSE\");break;case l.Pop:r=c(\"POP\");break;case l.GetLocal:r=u(\"GET_LOCAL\");break;case l.SetLocal:r=u(\"SET_LOCAL\");break;case l.GetGlobal:r=m(\"GET_GLOBAL\");break;case l.DefineGlobal:r=m(\"DEFINE_GLOBAL\");break;case l.SetGlobal:r=m(\"SET_GLOBAL\");break;case l.Eq:r=c(\"NIL\");break;case l.Gt:r=c(\"GT\");break;case l.Ge:r=c(\"GE\");break;case l.Lt:r=c(\"LT\");break;case l.Le:r=c(\"LE\");break;case l.Ne:r=c(\"NE\");break;case l.Not:r=c(\"NOT\");break;case l.Add:r=c(\"ADD\");break;case l.Sub:r=c(\"SUB\");break;case l.Mul:r=c(\"MUL\");break;case l.Div:r=c(\"DIV\");break;case l.Neg:r=c(\"NEG\");break;case l.Print:r=c(\"PRINT\");break;case l.Exit:r=c(\"EXIT\");break;case l.Command:r=p(\"CMD\");break;case l.Jump:r=E(\"JUMP\",Ne);break;case l.JumpIfFalse:r=E(\"JUMP_IF_FALSE\",Ne);break;case l.Loop:r=E(\"LOOP\",ui);break;case l.Return:r=c(\"RETURN\");break;default:r=[String(e),String(t),\"Unknown opcode\",hi(i)]}return[t,r]}let Re=!0,_e=!1;Re=ke(process.env.NO_TRACE),_e=ke(process.env.DEBUG_SHOW_UNDEF);function pi(s){Re||console.log(li(s))}const mi=le.getTracer(\"main\");function y(s,t,e,i){let r,n,o;if(arguments.length<2)return;arguments.length===2?o=t:arguments.length===3?(r=t,o=e):(r=t,n=e,o=i);const c=E=>{try{return o(E)}catch(d){throw E.recordException(d),d}finally{E.end()}},u=n??ue.active(),m=mi.startSpan(s,r,u),p=le.setSpan(u,m);return ue.with(p,c,void 0,m)}class $e{format(t){return\"nil\"}}class Vt{format(t){return _e?\"undef\":\"nil\"}}const z=new $e,Pe=new Vt;function J(s){const t=typeof s;return t===\"boolean\"?h.Boolean:t===\"number\"?Number.isInteger(s)?h.Integer:h.Real:t===\"string\"?h.String:s instanceof $e?h.Nil:s instanceof Vt?h.Undef:s instanceof T?h.Exception:h.Unknown}function pt(s,t=h.Any){switch(t===h.Any&&(t=J(s)),t){case h.Nil:case h.Undef:return!0;default:return!1}}function Zt(s){return pt(s)?\"nil\":S.format(s)}function di(s){const t={...ms.env};for(const[e,i]of Object.entries(s))pt(i)?t[e]=void 0:t[e]=Zt(i);return t}function gi(s,t){const e=[s.io[0].nodeStdIO(),s.io[1].nodeStdIO(),s.io[2].nodeStdIO()];return[Zt(s.command),s.args.map(i=>Zt(i)),{cwd:this.host.cwd,env:di(s.env),stdio:e,detached:t}]}function wi(s,t,e,i){var r=arguments.length,n=r<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i,o;if(typeof Reflect==\"object\"&&typeof Reflect.decorate==\"function\")n=Reflect.decorate(s,t,e,i);else for(var c=s.length-1;c>=0;c--)(o=s[c])&&(n=(r<3?o(n):r>3?o(t,e,n):o(t,e))||n);return r>3&&n&&Object.defineProperty(t,e,n),n}function Oe(s,t){if(typeof Reflect==\"object\"&&typeof Reflect.metadata==\"function\")return Reflect.metadata(s,t)}var X=function(s){return s[s.Debug=0]=\"Debug\",s[s.Info=1]=\"Info\",s[s.Warn=2]=\"Warn\",s[s.Error=3]=\"Error\",s}({});class Xt{formatter=new Ut;inputStream;outputStream;errorStream;level=1;_tty=void 0;cwd=process.cwd();constructor(){this.inputStream=gs,this.outputStream=ws,this.errorStream=vs}setLevel(t){this.level=t}writeOut(t){this.outputStream.write(this.formatter.format(t))}writeError(t){this.errorStream.write(this.formatter.format(t))}writeLine(t){this.outputStream.write(`${this.formatter.format(t)}\n`)}writeErrorLine(t){this.errorStream.write(`${this.formatter.format(t)}\n`)}writeDebug(t){this.level<=0&&this.errorStream.write(`DEBUG: ${this.formatter.format(t)}\n`)}writeInfo(t){this.level<=1&&this.errorStream.write(`INFO: ${this.formatter.format(t)}\n`)}writeWarn(t){this.level<=2&&this.errorStream.write(`WARN: ${this.formatter.format(t)}\n`)}writeException(t){let e=t;(typeof t==\"string\"||typeof t==\"number\"||typeof t==\"boolean\")&&(e=new T(String(t),null)),this.errorStream.write(`${this.formatter.format(e)}\n`)}writeChannel(t,e){switch(t){case 1:this.writeOut(e);break;case 2:this.writeError(e);break;case 3:this.writeWarn(e);break;case 4:this.writeInfo(e);break;case 5:this.writeDebug(e);break;default:throw new G(`Unknown channel: ${t}`,k.NoEntity,v.IoError,[`#${t}`],null)}}exit(t){throw new W(t)}hostname(){return at.hostname()}tty(){if(typeof this._tty>\"u\")try{const{stdout:t}=Es(\"tty\");this._tty=t.toString().trim()}catch{this._tty=null}return this._tty}shell(){return process.env.__MATBAS_DOLLAR_ZERO?process.env.__MATBAS_DOLLAR_ZERO:nt.basename(process.argv[1])}now(){return new Date}uid(){return at.userInfo().uid}gid(){return at.userInfo().gid}username(){return at.userInfo().username}homedir(){return at.homedir()}cd(t){if(t===\"\"){this.cwd=this.homedir();return}this.cwd=this.resolvePath(t)}pwd(t){return this.cwd}resolvePath(t){return t=t.replace(/^~\\//,this.homedir()+\"/\"),t.startsWith(\"/\")||t.startsWith(\"\\\\\")?t:nt.resolve(nt.join(this.cwd,t))}relativePath(t,e){return nt.relative(this.resolvePath(t),this.resolvePath(e))}async readFile(t){try{return await bs(this.resolvePath(t),\"utf8\")}catch(e){throw G.fromReadError(null,e)}}async writeFile(t,e){try{await ys(this.resolvePath(t),e,\"utf8\")}catch(i){throw G.fromWriteError(null,i)}}spawn(t,e){return he.apply(he,gi(t,e))}}Xt=wi([rt(),Oe(\"design:type\",Function),Oe(\"design:paramtypes\",[])],Xt);function vi(s,t,e,i){var r=arguments.length,n=r<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i,o;if(typeof Reflect==\"object\"&&typeof Reflect.decorate==\"function\")n=Reflect.decorate(s,t,e,i);else for(var c=s.length-1;c>=0;c--)(o=s[c])&&(n=(r<3?o(n):r>3?o(t,e,n):o(t,e))||n);return r>3&&n&&Object.defineProperty(t,e,n),n}function Be(s,t){if(typeof Reflect==\"object\"&&typeof Reflect.metadata==\"function\")return Reflect.metadata(s,t)}let Fe=\"\";Fe=`\nDEBUG_TRACE           enable debug tracing\nDEBUG_SHOW_TREE       log resulting parse trees\nDEBUG_SHOW_CHUNK      log compiled chunks\nDEBUG_TRACE_RUNTIME   enable runtime execution tracing`;const je=`Usage: matbas [options] [ script.bas ] [arguments]\n\nOptions:\n  -h, --help                  print matbas command line options\n  -c, --command <command>     evaluate command\n  -e, --eval <script>         evaluate script\n  -v, --version               print matbas version\n  --log-level <level>         set log level (debug, info, warn, error)\n  --history-size <size>       set the in-memory history size. defaults to 500.\n                              set to -1 for an unlimited history size\n  --history-file-size <size>  set the size of the history file. defaults to\n                              history size.\n  \nEnvironment variables:\nMATBAS_LOG_LEVEL      set log level (debug, info, warn, error)\nHISTSIZE              set the in-memory history size. defaults to 500. set to\n                      -1 for an unlimited history size.\nHISTFILESIZE          set the maximum size of the history file. defaults to\n                      history size.${Fe}\n`;function bi(){return new W(v.Success,je)}function yi(){return new W(v.Success,`v${Bt.version}`)}function H(s){return new Nt(`${s}\n${je}`)}const Ei={debug:X.Debug,info:X.Info,warn:X.Warn,error:X.Error};function Ae(s){const t=Ei[s];if(typeof t>\"u\")throw H(`Invalid log level: ${s} (must be one of: debug, info, warn, error)`);return t}function Rt(s){let t=parseInt(s);if(Number.isNaN(t))throw H(\"Invalid size (must be an integer)\");return t<1&&(t=Number.MAX_SAFE_INTEGER),t}class A{command;script;level;historySize;historyFileSize;argv;env;eval;constructor(t,e,i,r,n,o,c,u){this.command=t,this.script=i,this.level=r,this.historySize=n,this.historyFileSize=o,this.argv=c,this.env=u,this.eval=e}static load(t,e){let i=null,r=null,n=null,o=X.Info,c=500,u=500;const m=[process.env.__MATBAS_DOLLAR_ZERO||\"matbas\"];e.MATBAS_LOG_LEVEL&&(o=Ae(e.MATBAS_LOG_LEVEL)),e.HISTSIZE&&(c=Rt(e.HISTSIZE)),e.HISTFILESIZE&&(u=Rt(e.HISTFILESIZE));const p=Array.from(t);for(;p.length;)switch(p[0]){case\"-h\":case\"--help\":throw bi();case\"-c\":case\"--command\":if(p.shift(),!p.length)throw H(\"no command provided\");i=p.shift();break;case\"-e\":case\"--eval\":if(p.shift(),!p.length)throw H(\"No source to eval provided\");r=p.shift();break;case\"--log-level\":if(p.shift(),!p.length)throw H(\"No log level provided\");o=Ae(p.shift());break;case\"--history-size\":if(p.shift(),!p.length)throw H(\"No history size provided\");c=Rt(p.shift());break;case\"--history-file-size\":if(p.shift(),!p.length)throw H(\"No history file size provided\");u=Rt(p.shift());break;case\"-v\":case\"--version\":throw yi();default:if(!n&&!p[0].startsWith(\"-\")){const E=p.shift();n=E,m.push(E);break}if(n||i||r){m.push(p.shift());break}throw H(`Invalid option: ${p.shift()}`)}return new A(i,r,n,o,c,Math.min(c,u),m,e)}toString(){return JSON.stringify({command:this.command,eval:this.eval,script:this.script,logLevel:this.level,historySize:this.historySize,historyFileSize:this.historyFileSize,argv:this.argv},null,2)}}A=vi([rt(),Be(\"design:type\",Function),Be(\"design:paramtypes\",[Object,Object,Object,typeof X>\"u\"?Object:X,Number,Number,typeof Argv>\"u\"?Object:Argv,typeof Env>\"u\"?Object:Env])],A);class Ii{name;executor;host;_editor;constructor(t,e,i,r){this.name=t,this.executor=e,this.host=i,this._editor=r||null}interactive(){if(!this._editor)throw new O(`Command ${this.name} must be run in an interactive context`)}get editor(){return this.interactive(),this._editor}get program(){return this.editor.program}}const xi={async main(s,t){return y(\"new\",e=>{const{executor:i,editor:r}=s;let[n]=t;if(!n)n=\"untitled.bas\";else if(typeof n!=\"string\")throw new ct(`Invalid filename; ${S.format(n)}`);i.defer(async()=>{i.runtime.reset()}),r.reset(),r.filename=n})}};class We{name;aliases;constructor(t,e){this.name=t,this.aliases=e||[]}}class _t extends We{constructor(t){super(t)}}class Te extends _t{}let De=class extends _t{};class mt extends We{}class Yt{args;argv;opts;aliases;constructor(t){this.args=[],this.argv=[],this.opts={},this.aliases={};for(const e of t){e instanceof De?this.argv.push(e.name):e instanceof _t?this.args.push(e):this.opts[e.name]=e;for(const i of e.aliases)this.aliases[i]=e.name}}parse(t){const e=[],i={};for(const f of this.argv)i[f]=[];for(const f of this.args)i[f.name]=z;for(const f of Object.keys(this.opts))i[f]=z;let r=0;const n=(f=1)=>{r+=f},o=f=>(f=this.aliases[f]?this.aliases[f]:f,this.opts[f]||null),c=(f=1)=>t[r+f],u=(f,$=!0)=>{const P=o(f);if(P){if(P instanceof mt){i[P.name]=$,n();return}i[P.name]=c(),n(2);return}throw new Z(`Unknown flag or option --${f}`)},m=f=>{try{u(f,!0)}catch($){if(!($ instanceof Z))throw $;u(f.slice(3),!1)}},p=f=>{let $=1;for(let P=0;P<f.length;P++){const oe=f[P],yt=o(oe);if(yt){if(yt instanceof mt){i[yt.name]=!0;continue}if(P!==f.length-1)throw new Z(`Option flag -${oe} must be followed by a value`);i[yt.name]=c(),$=2}}n($)},E=()=>{e.push(c(0)),n()};for(;r<t.length;){const f=t[r];if(typeof f==\"string\"){if(f.match(/^--no-/)){m(f.slice(2));continue}if(f.match(/^--/)){u(f.slice(2),!0);continue}if(f.match(/^-/)){p(f.slice(1));continue}}E()}let d=0;for(const f of this.args){if(d>=e.length){if(f instanceof Te){i[f.name]=z,d++;continue}throw new Z(`Expected argument ${f.name}`)}if(f instanceof De){i[f.name]=e.slice(d),d=e.length;continue}i[f.name]=e[d],d++}if(d<e.length)throw new Z(`Unexpected argument ${e[d]}`);return i}}const ki={params:new Yt([new _t(\"filename\"),new mt(\"run\")]),async main(s,t){return await y(\"load\",async e=>{const{executor:i,editor:r,host:n}=s,{filename:o,run:c}=this.params.parse(t);if(typeof o!=\"string\")throw new ct(`Invalid filename; ${S.format(o)}`);await i.load(o),c?await i.run():r.warning&&n.writeWarn(r.warning)})}},Si={async main(s,t){y(\"list\",e=>{const{host:i,editor:r}=s,[n,o]=t,c=pt(n)?null:n,u=pt(o)?null:o;r.warning&&i.writeWarn(this.editor.warning),i.writeLine(`${r.filename}\n${\"-\".repeat(r.filename.length)}`);const m=r.list(c,u);i.writeLine(m)})}},Li={async main(s,t){return y(\"renum\",e=>{s.editor.renum()})}},Ni={async main(s,t){return await y(\"save\",async e=>{const{host:i,editor:r}=s,[n]=t;if(n!==null&&typeof n!=\"string\")throw new ct(`Invalid filename; ${S.format(n)}`);n&&(r.filename=n),await i.writeFile(r.filename,r.list()+`\n`)})}},Ri={async main(s,t){s.interactive(),await s.executor.run()}},_i={params:new Yt([new Te(\"path\")]),async main(s,t){return y(\"cd\",e=>{const{host:i}=s,{path:r}=this.params.parse(t);i.cd(r)})}},$i={params:new Yt([new mt(\"P\"),new mt(\"L\")]),async main(s,t){return y(\"pwd\",e=>{const{host:i}=s,r=this.params.parse(t);let n=!0;r.P&&(n=!1),i.writeLine(i.pwd(n))})}},Pi={new:xi,load:ki,list:Si,renum:Li,save:Ni,run:Ri,cd:_i,pwd:$i};var a=function(s){return s.LParen=\"(\",s.RParen=\")\",s.Comma=\",\",s.Semicolon=\";\",s.Colon=\":\",s.Dot=\".\",s.Plus=\"+\",s.Minus=\"-\",s.Star=\"*\",s.Percent=\"%\",s.Dollar=\"$\",s.Hash=\"#\",s.Bang=\"!\",s.Slash=\"/\",s.BSlash=\"\\\\\",s.Eq=\"=\",s.EqEq=\"==\",s.Gt=\">\",s.Lt=\"<\",s.Ge=\">=\",s.Le=\"<=\",s.Ne=\"<>\",s.BangEq=\"!=\",s.And=\"and\",s.Or=\"or\",s.Not=\"not\",s.DecimalLiteral=\"<decimal>\",s.HexLiteral=\"<hex>\",s.OctalLiteral=\"<octal>\",s.BinaryLiteral=\"<binary>\",s.RealLiteral=\"<real>\",s.TrueLiteral=\"true\",s.FalseLiteral=\"false\",s.StringLiteral=\"<string>\",s.NilLiteral=\"nil\",s.Ident=\"<ident>\",s.IntIdent=\"<ident%>\",s.RealIdent=\"<ident!>\",s.BoolIdent=\"<ident?>\",s.StringIdent=\"<ident$>\",s.LongFlag=\"--<flag>\",s.ShellToken=\"<shell>\",s.New=\"new\",s.Load=\"load\",s.Save=\"save\",s.List=\"list\",s.Renum=\"renum\",s.Run=\"run\",s.End=\"end\",s.Exit=\"exit\",s.Let=\"let\",s.If=\"if\",s.Then=\"then\",s.Else=\"else\",s.EndIf=\"endif\",s.For=\"for\",s.To=\"to\",s.Step=\"step\",s.Onward=\"onward\",s.Next=\"next\",s.While=\"while\",s.EndWhile=\"endwhile\",s.Repeat=\"repeat\",s.Until=\"until\",s.Print=\"print\",s.Rem=\"<rem>\",s.LineEnding=\"\\\\n\",s.Whitespace=\"<whitespace>\",s.Eof=\"<EOF>\",s.Illegal=\"<illegal>\",s.UnterminatedStringLiteral=\"<unterminated-string>\",s}({});class Oi{kind;index;row;offsetStart;offsetEnd;text;value;constructor(t){this.kind=t.kind,this.index=t.index,this.row=t.row,this.offsetStart=t.offsetStart,this.offsetEnd=t.offsetEnd,this.text=t.text,this.value=t.value}format(t){return t.formatToken(this)}}class _{leadingWs;lineNo;separatingWs;source;constructor(t,e,i,r){this.leadingWs=t,this.lineNo=e,this.separatingWs=i,this.source=r}static empty(){return new _(\"\",\"\",\"\",\"\")}static command(t){return new _(\"\",\"\",\"\",t)}static unknown(){return new _(\"\",\"\",\"\",\"<unknown>\")}clone(){return new _(this.leadingWs,this.lineNo,this.separatingWs,this.source)}get prefix(){return this.leadingWs+this.lineNo+this.separatingWs}toString(){return this.prefix+this.source}}class M{kind=\"<unknown>\";_compiler=null;instr=null;previous=null;parent=null;init(t,e,i,r){this._compiler=t,this.instr=e,this.previous=i,this.parent=r}get compiler(){if(!this._compiler)throw x.fromError(new O(`Block ${this.kind} not initialized`));return this._compiler}begin(t,e){e.init(this.compiler,t,null,this.compiler.block),this.compiler.block=e}next(t,e){e.init(this.compiler,t,this.compiler.block,this.compiler.block.parent),this.compiler.block=e}end(){xt.ok(this.parent),this.compiler.block=this.parent}handle(t){t.accept(this)}invalid(t,e){this.compiler.syntaxFault(t,`${e} can not end blocks`)}mismatched(t,e){this.compiler.syntaxFault(t,`${e} can not end ${this.kind}`)}visitPrintInstr(t){this.invalid(t,\"print\")}visitExpressionInstr(t){this.invalid(t,\"expr\")}visitRemInstr(t){this.invalid(t,\"rem\")}visitNewInstr(t){this.invalid(t,\"new\")}visitLoadInstr(t){this.invalid(t,\"load\")}visitListInstr(t){this.invalid(t,\"list\")}visitRenumInstr(t){this.invalid(t,\"renum\")}visitSaveInstr(t){this.invalid(t,\"save\")}visitRunInstr(t){this.invalid(t,\"run\")}visitExitInstr(t){this.invalid(t,\"exit\")}visitEndInstr(t){this.invalid(t,\"end\")}visitLetInstr(t){this.invalid(t,\"let\")}visitAssignInstr(t){this.invalid(t,\"assign\")}visitShortIfInstr(t){this.invalid(t,\"if\")}visitIfInstr(t){this.invalid(t,\"if\")}visitElseInstr(t){this.mismatched(t,\"else\")}visitElseIfInstr(t){this.mismatched(t,\"else if\")}visitEndIfInstr(t){this.mismatched(t,\"endif\")}visitForInstr(t){this.invalid(t,\"for\")}visitOnwardInstr(t){this.invalid(t,\"onward\")}visitNextInstr(t){this.mismatched(t,\"next\")}visitWhileInstr(t){this.invalid(t,\"while\")}visitEndWhileInstr(t){this.mismatched(t,\"endwhile\")}visitRepeatInstr(t){this.invalid(t,\"repeat\")}visitUntilInstr(t){this.mismatched(t,\"until\")}visitCommandInstr(t){this.invalid(t,S.format(t))}}const Qt=-1,Ue=-1;class Bi{compiler;locals;count;depth;constructor(t){this.compiler=t,this.locals=[],this.depth=0}begin(){this.depth++}end(){for(this.depth--;this.locals.length>0&&this.locals[this.locals.length-1].depth>this.depth;)this.compiler.emitByte(l.Pop),this.locals.pop()}ident(t){return this.declare(t),this.depth>0?0:this.compiler.makeIdent(t)}define(t){if(this.depth>0){this.initialize(this.locals.length-1);return}this.compiler.emitBytes(l.DefineGlobal,t)}initialize(t){this.locals[t].depth=this.depth}declare(t){if(this.depth){for(let e=this.locals.length-1;e>=0;e--){const i=this.locals[e];if(i.depth!==Qt&&i.depth<this.depth)break;t.value===i.name.value&&this.compiler.syntaxError(this.compiler.peek(),`Already a variable named ${t.value} in this scope.`)}this.addLocal(t)}}addLocal(t){const e={name:t,depth:Qt};this.locals.push(e)}get(t){let e,i=this.resolveLocal(t);i!==-1?e=l.GetLocal:(i=this.compiler.makeIdent(t),e=l.GetGlobal),this.compiler.emitBytes(e,i)}assign(t){let e,i=this.resolveLocal(t);i!==Ue?e=l.SetLocal:(i=this.compiler.makeIdent(t),e=l.SetGlobal),this.compiler.emitBytes(e,i)}resolveLocal(t){for(let e=this.locals.length-1;e>=0;e--){const i=this.locals[e];if(t.value===i.name.value)return i.depth===Qt&&this.compiler.syntaxError(this.compiler.peek(),`Can not read ${t.value} in its own definition.`),e}return Ue}}class Kt{filename=\"<unknown>\";constants=[];code=[];lines=[];writeOp(t,e){this.code.push(t),this.lines.push(e)}addConstant(t){return this.constants.push(t),this.constants.length-1}}function Je(s,t,e,i){var r=arguments.length,n=r<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i,o;if(typeof Reflect==\"object\"&&typeof Reflect.decorate==\"function\")n=Reflect.decorate(s,t,e,i);else for(var c=s.length-1;c>=0;c--)(o=s[c])&&(n=(r<3?o(n):r>3?o(t,e,n):o(t,e))||n);return r>3&&n&&Object.defineProperty(t,e,n),n}function dt(s,t){if(typeof Reflect==\"object\"&&typeof Reflect.metadata==\"function\")return Reflect.metadata(s,t)}let gt=class extends Error{constructor(){super(\"Synchronize\"),Object.setPrototypeOf(this,new.target.prototype)}};gt=Je([g(\"Synchronize\"),dt(\"design:type\",Function),dt(\"design:paramtypes\",[])],gt);let Ge=class extends M{kind=\"global\"},Ce=class extends M{kind=\"program\"},ze=class extends M{kind=\"command\"};function Fi(s){return s instanceof Ce||s instanceof ze||s instanceof Ge}let He=class extends M{elseJump;kind=\"if\";constructor(t){super(),this.elseJump=t}visitElseInstr(t){const e=this.compiler.beginElse(this.elseJump);this.next(t,new ji(e))}visitElseIfInstr(t){const e=this.compiler.beginElse(this.elseJump),i=this.compiler.beginIf(t.condition);this.next(t,new Me(i,e))}visitEndIfInstr(t){const e=this.compiler.beginElse(this.elseJump);this.compiler.endIf(e),this.end()}},ji=class extends M{endJump;kind=\"else\";constructor(t){super(),this.endJump=t}visitEndIfInstr(t){this.compiler.endIf(this.endJump),this.end();let e=this.previous;for(;e instanceof Me;)e.compiler.endIf(e.endJump),e.end(),e=e.parent}},Me=class ls extends He{endJump;kind=\"else if\";constructor(t,e){super(t),this.endJump=e}visitEndIfInstr(t){const e=this.compiler.beginElse(this.elseJump);this.compiler.endIf(e);let i=this;for(;i instanceof ls;)i.compiler.endIf(i.endJump),i.end(),i=i.previous}},Ai=class extends M{incrStart;exitJump;kind=\"for\";constructor(t,e){super(),this.incrStart=t,this.exitJump=e}visitOnwardInstr(t){super.visitOnwardInstr(t)}visitNextInstr(t){this.compiler.endFor(this.incrStart,this.exitJump),this.end()}},Wi=class extends M{loopStart;exitJump;kind=\"while\";constructor(t,e){super(),this.loopStart=t,this.exitJump=e}visitOnwardInstr(t){super.visitOnwardInstr(t)}visitEndWhileInstr(t){this.compiler.endWhile(this.loopStart,this.exitJump),this.end()}},Ti=class extends M{startJump;kind=\"repeat\";constructor(t){super(),this.startJump=t}visitOnwardInstr(t){super.visitOnwardInstr(t)}visitUntilInstr(t){this.compiler.endRepeat(t,this.startJump),this.end()}};class te{currentChunk;lines=[];currentInstrNo=-1;currentLine=0;filename;routineType=0;isReturningInstruction=!1;isError=!1;errors=[];global;block;scope;constructor(t,e,{filename:i}){this.lines=t,this.routineType=e,this.currentChunk=new Kt,this.filename=i||\"<unknown>\",this.currentChunk.filename=this.filename,this.routineType=e,this.isError=!1,this.errors=[],this.global=new Ge,this.global.init(this,null,null,null),this.block=e===1?new Ce:new ze,this.block.init(this,null,null,this.global),this.scope=new Bi(this)}compile(){let t=this.advance();for(;t;)try{this.instruction(t),t=this.advance()}catch(e){if(e instanceof gt){this.synchronize(),t=this.peek();continue}throw e}try{this.checkBlocksClosed()}catch(e){if(!(e instanceof gt))throw e}if(this.isError)throw new R(this.errors);return this.emitReturn(),pi(this.chunk),[this.chunk,null]}get chunk(){return this.currentChunk}match(...t){for(const e of t)if(this.check(e))return this.advance(),!0;return!1}check(t){return this.done?!1:this.peek()instanceof t}advance(){if(this.done)return null;for(this.currentInstrNo++;!this.done&&this.currentInstrNo>=this.lines[this.currentLine].instructions.length;)this.currentLine++,this.currentInstrNo=0;return this.done?null:this.peek()}get done(){return this.currentLine>=this.lines.length}peek(){return this.done?null:this.lines[this.currentLine].instructions[this.currentInstrNo]}createSyntaxError(t,e){return new lt(e,{filename:this.filename,row:this.rowNo,isLine:this.routineType!==0,lineNo:this.lineNo,cmdNo:this.routineType===0?null:this.lineNo,offsetStart:t.offsetStart,offsetEnd:t.offsetEnd,source:this.lineSource})}syntaxError(t,e){const i=this.createSyntaxError(t,e);throw this.isError=!0,this.errors.push(i),new gt}syntaxFault(t,e){const i=this.createSyntaxError(t,e);throw x.fromError(i)}synchronize(){this.currentLine++,this.currentInstrNo=0}get lineNo(){return this.currentLine>=this.lines.length?this.lines[this.lines.length-1].lineNo:this.lines[this.currentLine].lineNo}get rowNo(){return this.currentLine>=this.lines.length?this.lines[this.lines.length-1].row:this.lines[this.currentLine].row}get lineSource(){return this.currentLine>=this.lines.length?this.lines[this.lines.length-1].source:this.lines[this.currentLine].source}checkBlocksClosed(){Fi(this.block)||this.syntaxError(this.block.instr,`${this.block.kind} has not been closed`)}emitByte(t){this.currentChunk.writeOp(t,this.lineNo)}emitBytes(...t){for(const e of t)this.emitByte(e)}emitConstant(t){this.emitBytes(l.Constant,this.makeConstant(t))}emitJump(t){return this.emitByte(t),this.emitBytes(255,255),this.chunk.code.length-2}patchJump(t){const e=this.chunk.code.length-t-2,[i,r]=Se(e);this.chunk.code[t]=i,this.chunk.code[t+1]=r}emitLoop(t){this.emitByte(l.Loop);const e=this.chunk.code.length-t+2,[i,r]=Se(e);this.emitBytes(i,r)}emitReturn(){(this.routineType!==0||!this.isReturningInstruction)&&this.emitByte(l.Undef),this.emitByte(l.Return)}makeConstant(t){return this.currentChunk.addConstant(t)}makeIdent(t){return this.makeConstant(t.value)}instruction(t){t.accept(this)}visitPrintInstr(t){t.expression.accept(this),this.emitByte(l.Print)}visitExpressionInstr(t){this.isReturningInstruction=!0,t.expression.accept(this),this.routineType===1&&this.emitByte(l.Pop)}visitRemInstr(t){}visitNewInstr(t){let e=1;this.emitConstant(\"new\"),t.filename&&(t.filename.accept(this),e=2),this.emitBytes(l.Command,e)}visitLoadInstr(t){this.emitConstant(\"load\");for(const e of t.params)e.accept(this);this.emitBytes(l.Command,1+t.params.length)}visitListInstr(t){this.emitConstant(\"list\"),this.emitConstant(t.lineStart||z),this.emitConstant(t.lineEnd||z),this.emitBytes(l.Command,3)}visitRenumInstr(t){this.emitConstant(\"renum\"),this.emitBytes(l.Command,1)}visitSaveInstr(t){this.emitConstant(\"save\"),t.filename?t.filename.accept(this):this.emitConstant(z),this.emitBytes(l.Command,2)}visitRunInstr(t){this.emitConstant(\"run\"),this.emitBytes(l.Command,1)}visitEndInstr(t){this.emitReturn()}visitExitInstr(t){t.expression?t.expression.accept(this):this.emitConstant(0),this.emitByte(l.Exit)}visitLetInstr(t){this.let_(t.variable,t.value)}let_(t,e){const i=this.scope.ident(t.ident);e?e.accept(this):this.emitByte(l.Nil),this.scope.define(i)}visitAssignInstr(t){this.assign(t.variable,t.value)}assign(t,e){e.accept(this),this.scope.assign(t.ident)}visitShortIfInstr(t){const e=this.beginIf(t.condition);for(const r of t.then)this.instruction(r);const i=this.beginElse(e);for(const r of t.else_)this.instruction(r);this.endIf(i)}visitIfInstr(t){const e=this.beginIf(t.condition);this.block.begin(t,new He(e))}beginIf(t){t.accept(this);const e=this.emitJump(l.JumpIfFalse);return this.emitByte(l.Pop),e}visitElseInstr(t){this.block.handle(t)}beginElse(t){const e=this.emitJump(l.Jump);return this.patchJump(t),this.emitByte(l.Pop),e}visitElseIfInstr(t){this.block.handle(t)}visitEndIfInstr(t){this.block.handle(t)}endIf(t){this.patchJump(t)}visitForInstr(t){const{variable:e,value:i,stop:r}=t,n=t.step||new jt(1),[o,c]=this.beginFor(e,i,r,n);this.block.begin(t,new Ai(o,c))}beginFor(t,e,i,r){const n=new tt(t,a.Le,i),o=new tt(t,a.Plus,r);this.scope.begin(),this.let_(t,e);const c=this.chunk.code.length;n.accept(this);const u=this.emitJump(l.JumpIfFalse);this.emitByte(l.Pop);const m=this.emitJump(l.Jump),p=this.chunk.code.length;return this.assign(t,o),this.emitByte(l.Pop),this.emitLoop(c),this.patchJump(m),[p,u]}visitNextInstr(t){this.block.handle(t)}endFor(t,e){this.emitLoop(t),this.scope.end(),this.patchJump(e)}visitWhileInstr(t){const[e,i]=this.beginWhile(t.condition);this.block.begin(t,new Wi(e,i))}beginWhile(t){const e=this.chunk.code.length;t.accept(this);const i=this.emitJump(l.JumpIfFalse);return this.emitByte(l.Pop),[e,i]}visitEndWhileInstr(t){this.block.handle(t)}endWhile(t,e){this.emitLoop(t),this.patchJump(e)}visitRepeatInstr(t){const e=this.chunk.code.length;this.block.begin(t,new Ti(e))}visitUntilInstr(t){this.block.handle(t)}endRepeat(t,e){t.condition.accept(this);const i=this.emitJump(l.JumpIfFalse);this.emitByte(l.Pop),this.emitLoop(e),this.patchJump(i)}visitOnwardInstr(t){this.block.handle(t)}visitCommandInstr(t){t.name.accept(this);for(const e of t.params)e.accept(this);this.emitBytes(l.Command,1+t.params.length)}visitUnaryExpr(t){switch(t.expr.accept(this),t.op){case a.Plus:break;case a.Minus:this.emitByte(l.Neg);break;case a.Not:this.emitByte(l.Not);break;default:this.syntaxError(this.peek(),\"Invalid unary operator\")}}visitBinaryExpr(t){switch(t.left.accept(this),t.right.accept(this),t.op){case a.Plus:this.emitByte(l.Add);break;case a.Minus:this.emitByte(l.Sub);break;case a.Star:this.emitByte(l.Mul);break;case a.Slash:this.emitByte(l.Div);break;case a.EqEq:this.emitByte(l.Eq);break;case a.Gt:this.emitByte(l.Gt);break;case a.Ge:this.emitByte(l.Ge);break;case a.Lt:this.emitByte(l.Lt);break;case a.Le:this.emitByte(l.Le);break;case a.Ne:this.emitByte(l.Ne);break;default:this.syntaxError(this.peek(),\"Invalid binary operator\")}}visitLogicalExpr(t){switch(t.op){case a.And:this.emitAnd(t);break;case a.Or:this.emitOr(t);break;default:this.syntaxError(this.peek(),\"Invalid logical operator\")}}emitAnd(t){t.left.accept(this);const e=this.emitJump(l.JumpIfFalse);this.emitByte(l.Pop),t.right.accept(this),this.patchJump(e)}emitOr(t){t.left.accept(this);const e=this.emitJump(l.JumpIfFalse),i=this.emitJump(l.Jump);this.patchJump(e),this.emitByte(l.Pop),t.right.accept(this),this.patchJump(i)}visitGroupExpr(t){t.expr.accept(this)}visitVariableExpr(t){this.scope.get(t.ident)}visitIntLiteralExpr(t){this.emitConstant(t.value)}visitRealLiteralExpr(t){this.emitConstant(t.value)}visitBoolLiteralExpr(t){this.emitConstant(t.value)}visitStringLiteralExpr(t){this.emitConstant(t.value)}visitShellLiteralExpr(t){this.emitConstant(t.value)}visitPromptLiteralExpr(t){}visitNilLiteralExpr(t){this.emitByte(l.Nil)}}Je([qt,dt(\"design:type\",Function),dt(\"design:paramtypes\",[]),dt(\"design:returntype\",typeof CompileResult>\"u\"?Object:CompileResult)],te.prototype,\"compile\",null);function Di(s,t={}){return y(\"compileInstruction\",e=>{const{cmdNo:i,cmdSource:r}=t,n=[new Tt(i||100,1,r||_.unknown(),[s])];return new te(n,0,t).compile()})}function Ui(s,t={}){const e=s.map(n=>{const[o,c]=Di(n,t);return[o,c]}),i=e.map(([n,o])=>n),r=e.reduce((n,[o,c])=>c?n.concat(c):n,[]);return[i,et(r)]}function Ji(s,t={}){return y(\"compileProgram\",e=>new te(s.lines,1,t).compile())}function Gi(s,t,e,i){var r=arguments.length,n=r<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i,o;if(typeof Reflect==\"object\"&&typeof Reflect.decorate==\"function\")n=Reflect.decorate(s,t,e,i);else for(var c=s.length-1;c>=0;c--)(o=s[c])&&(n=(r<3?o(n):r>3?o(t,e,n):o(t,e))||n);return r>3&&n&&Object.defineProperty(t,e,n),n}function qe(s,t){if(typeof Reflect==\"object\"&&typeof Reflect.metadata==\"function\")return Reflect.metadata(s,t)}function Ci(s,t){return function(e,i){t(e,i,s)}}const Ve=-1;let zi=class{shift;constructor(t){this.shift=t}shiftInstr(t){t.offsetStart+=this.shift,t.offsetEnd+=this.shift}shiftToken(t){t.offsetStart+=this.shift,t.offsetEnd+=this.shift}visitRemInstr(t){this.shiftInstr(t)}visitLetInstr(t){this.shiftInstr(t),t.variable.accept(this)}visitAssignInstr(t){this.shiftInstr(t),t.variable.accept(this)}visitExpressionInstr(t){this.shiftInstr(t),t.expression.accept(this)}visitPrintInstr(t){this.shiftInstr(t),t.expression.accept(this)}visitExitInstr(t){this.shiftInstr(t),t.expression&&t.expression.accept(this)}visitEndInstr(t){this.shiftInstr(t)}visitNewInstr(t){this.shiftInstr(t),t.filename&&t.filename.accept(this)}visitLoadInstr(t){this.shiftInstr(t);for(const e of t.params)e.accept(this)}visitListInstr(t){this.shiftInstr(t)}visitRenumInstr(t){this.shiftInstr(t)}visitRunInstr(t){this.shiftInstr(t)}visitSaveInstr(t){this.shiftInstr(t),t.filename&&t.filename.accept(this)}visitShortIfInstr(t){this.shiftInstr(t),t.condition.accept(this);for(const e of t.then)e.accept(this);for(const e of t.else_)e.accept(this)}visitIfInstr(t){this.shiftInstr(t),t.condition.accept(this)}visitElseInstr(t){this.shiftInstr(t)}visitElseIfInstr(t){this.shiftInstr(t),t.condition.accept(this)}visitEndIfInstr(t){this.shiftInstr(t)}visitForInstr(t){this.shiftInstr(t),t.variable.accept(this),t.value.accept(this),t.stop.accept(this),t.step!==null&&t.step.accept(this)}visitOnwardInstr(t){this.shiftInstr(t)}visitNextInstr(t){this.shiftInstr(t)}visitWhileInstr(t){this.shiftInstr(t),t.condition.accept(this)}visitEndWhileInstr(t){this.shiftInstr(t)}visitRepeatInstr(t){this.shiftInstr(t)}visitUntilInstr(t){this.shiftInstr(t),t.condition.accept(this)}visitCommandInstr(t){this.shiftInstr(t);for(const e of t.params)e.accept(this)}visitUnaryExpr(t){t.expr.accept(this)}visitBinaryExpr(t){t.left.accept(this),t.right.accept(this)}visitLogicalExpr(t){t.left.accept(this),t.right.accept(this)}visitGroupExpr(t){t.expr.accept(this)}visitVariableExpr(t){this.shiftToken(t.ident)}visitIntLiteralExpr(t){}visitRealLiteralExpr(t){}visitBoolLiteralExpr(t){}visitStringLiteralExpr(t){}visitShellLiteralExpr(t){}visitPromptLiteralExpr(t){}visitNilLiteralExpr(t){}};class wt{host;program;warning;justify=0;constructor(t){this.host=t,this.program=new Dt(\"untitled.bas\",[]),this.warning=null}get filename(){return this.host.relativePath(\".\",this.program.filename)}set filename(t){this.program.filename=this.host.resolvePath(t)}init(t,e){this.program=t,this.warning=e}reset(){this.program=new Dt(\"untitled.bas\",[]),this.warning=null}list(t=null,e=null){let i=0,r=this.program.lines[this.program.lines.length-1].lineNo;return t&&(i=t,e||(r=t)),e?r=e:t&&(r=t),this.program.lines.filter(n=>n.lineNo>=i&&n.lineNo<=r).map(n=>n.instructions.length===1&&n.instructions[0]instanceof At&&n.instructions[0].remark===\"\"?`${n.lineNo}`:n.source).join(`\n`)}renum(){const t={};let e=0;for(let i=0;i<this.program.lines.length;i++){const r=this.program.lines[i],n=r.lineNo,o=(i+1)*10,c=String(o);t[n]={to:o,toStr:c,shift:0,source:r.source},e=Math.max(e,c.length)}for(const i of this.program.lines){const r=i.lineNo,{to:n,toStr:o}=t[r],c=this.justify===0?\"\":\" \".repeat(e-o.length),u=this.justify===0?\" \".repeat(e-o.length+1):\" \",m=i.source.prefix.length,E=c.length+o.length+u.length-m;i.lineNo=n,i.source.leadingWs=c,i.source.lineNo=o,i.source.separatingWs=u;for(const d of i.instructions)d.accept(new zi(E));t[r].shift=E}if(this.warning)for(let i=0;i<this.warning.warnings.length;i++){const r=this.warning.warnings[i],{to:n,shift:o,source:c}=t[r.lineNo];n&&(r.lineNo=n,r.source=c,r.offsetStart+=o,r.offsetEnd+=o)}}findLineIndex(t){let e=0,i=this.program.lines.length-1;if(!this.program.lines.length)return{i:Ve,lineNo:null,match:!1};let r=this.program.lines[e],n=this.program.lines[i];if(r.lineNo>t)return{i:Ve,lineNo:null,match:!1};if(r.lineNo===t)return{i:e,lineNo:r.lineNo,match:!0};if(n.lineNo<=t)return{i,lineNo:n.lineNo,match:n.lineNo===t};for(;;){if(i-e<=1)return{i:e,lineNo:r.lineNo,match:!1};const o=Math.floor((e+i)/2),c=this.program.lines[o];if(c.lineNo===t)return{i:o,lineNo:c.lineNo,match:!0};c.lineNo>t?(i=o,n=c):c.lineNo<t&&(e=o,r=c)}}setLine(t,e){const{i,match:r}=this.findLineIndex(t.lineNo);if(!t.instructions.length){r&&(this.program.lines.splice(i,1),this.warning=oi(this.warning,\"lineNo\",t.lineNo));return}if(r){this.program.lines[i]=t,e&&(this.warning=et([this.warning,e]));return}this.program.lines.splice(i+1,0,t)}}wt=Gi([rt(),Ci(0,Et(\"Host\")),qe(\"design:type\",Function),qe(\"design:paramtypes\",[typeof Host>\"u\"?Object:Host])],wt);const ee={true:a.TrueLiteral,false:a.FalseLiteral,nil:a.NilLiteral,and:a.And,or:a.Or,not:a.Not,new:a.New,load:a.Load,save:a.Save,list:a.List,renum:a.Renum,run:a.Run,end:a.End,exit:a.Exit,let:a.Let,if:a.If,then:a.Then,else:a.Else,endif:a.EndIf,for:a.For,to:a.To,step:a.Step,onward:a.Onward,next:a.Next,while:a.While,endwhile:a.EndWhile,repeat:a.Repeat,until:a.Until,print:a.Print},se=\"\\0\",Hi=/[\\r\\t ]/;function Ze(s){return s.match(Hi)!==null}const Mi=/[0123456789]/;function Y(s){return s.match(Mi)!==null}const qi=/[0123456789abcdef]/i;function Vi(s){return s.match(qi)!==null}const Zi=/[012345678]/;function Xi(s){return s.match(Zi)!=null}const Yi=/[01]/;function Qi(s){return s.match(Yi)!=null}const Ki=/[abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ]/;function Xe(s){return s.match(Ki)!=null}function tr(s){return Xe(s)||Y(s)}const er=/[`#$&*()|[\\]{}:\\\\'\"<>?!]/;function Ye(s){return s.match(er)!=null}const sr=/\\r\\t\\n /;function ir(s){return s.match(sr)!=null}class rr{source;filename;start;current;row;offset;constructor(t,e){this.source=t,this.filename=e||\"<unknown>\",this.start=0,this.current=0,this.row=1,this.offset=0}get done(){return this.current>=this.source.length}match(t){return this.done||this.source[this.current]!=t?!1:(this.current++,!0)}peek(){return this.done?se:this.source[this.current]}peekNext(){return this.current+1>=this.source.length?se:this.source[this.current+1]}advance(){return this.source[this.current++]}emitToken(t,e=null){const i=this.source.slice(this.start,this.current),r=this.row,n=this.offset,o=this.offset+(this.current-this.start);return t===a.LineEnding?(this.offset=0,this.row++):this.offset+=this.current-this.start,new Oi({kind:t,index:this.start,row:r,offsetStart:n,offsetEnd:o,text:i,value:e})}nextToken(){if(this.start=this.current,this.done)return this.emitToken(a.Eof);const t=this.advance();switch(t){case\"\\r\":case\"	\":case\" \":return this.whitespace();case\"(\":return this.emitToken(a.LParen);case\")\":return this.emitToken(a.RParen);case\",\":return this.emitToken(a.Comma);case\";\":return this.emitToken(a.Semicolon);case\":\":return this.emitToken(a.Colon);case\".\":return this.emitToken(a.Dot);case\"+\":return this.emitToken(a.Plus);case\"-\":return this.emitToken(a.Minus);case\"*\":return this.emitToken(a.Star);case\"%\":return this.emitToken(a.Percent);case\"$\":return this.emitToken(a.Dollar);case\"!\":return this.match(\"=\")?this.emitToken(a.BangEq):this.emitToken(a.Bang);case\"/\":return this.emitToken(a.Slash);case\"\\\\\":return this.emitToken(a.BSlash);case\"=\":return this.match(\"=\")?this.emitToken(a.EqEq):this.emitToken(a.Eq);case\">\":return this.match(\"=\")?this.emitToken(a.Ge):this.emitToken(a.Gt);case\"<\":return this.match(\">\")?this.emitToken(a.Ne):this.match(\"=\")?this.emitToken(a.Le):this.emitToken(a.Lt);case\"#\":return this.emitToken(a.Hash);case'\"':return this.string('\"');case\"'\":return this.string(\"'\");case`\n`:return this.emitToken(a.LineEnding);case\"0\":return this.match(\"x\")?this.hex():this.match(\"o\")?this.octal():this.match(\"b\")?this.binary():this.decimal();case\"r\":if(this.peek()===\"e\"&&this.peekNext()===\"m\")return this.rem();default:return Y(t)?this.decimal():Xe(t)||t===\"_\"?this.identifier():Ye(t)?this.illegal():this.shell()}}whitespace(){for(;Ze(this.peek());)this.advance();const t=this.source.slice(this.start,this.current);return this.emitToken(a.Whitespace,t)}string(t){let e=t;for(;![t,`\n`,\"\\r\"].includes(this.peek())&&!this.done;){const i=this.advance();e+=i,i===\"\\\\\"&&(e+=this.advance())}return this.peek()!==t?this.emitToken(a.UnterminatedStringLiteral,e):(e+=t,this.advance(),this.emitToken(a.StringLiteral,e))}hex(){for(;(this.peek()===\"_\"||Vi(this.peek()))&&!this.done;)this.advance();let t;try{t=parseInt(this.source.slice(this.start+2,this.current),16)}catch(e){throw new x(\"Invalid hex literal\",e)}return this.emitToken(a.HexLiteral,t)}octal(){for(;(this.peek()===\"_\"||Xi(this.peek()))&&!this.done;)this.advance();let t;try{t=parseInt(this.source.slice(this.start+2,this.current),8)}catch(e){throw new x(\"Invalid octal literal\",e)}return this.emitToken(a.OctalLiteral,t)}binary(){for(;(this.peek()===\"_\"||Qi(this.peek()))&&!this.done;)this.advance();let t;try{t=parseInt(this.source.slice(this.start+2,this.current),16)}catch(e){throw new x(\"Invalid binary literal\",e)}return this.emitToken(a.BinaryLiteral,t)}decimal(){let t=!1;for(;(this.peek()===\"_\"||Y(this.peek()))&&!this.done;)this.advance();for(this.peek()===\".\"&&(this.peekNext()===\"_\"||Y(this.peekNext()))&&(t=!0,this.advance());(this.peek()===\"_\"||Y(this.peek()))&&!this.done;)this.advance();for(this.peek()===\"e\"&&(this.peek()===\"_\"||Y(this.peekNext()))&&(t=!0,this.advance());(this.peek()===\"_\"||Y(this.peek()))&&!this.done;)this.advance();let e;try{return t?(e=parseFloat(this.source.slice(this.start,this.current)),this.emitToken(a.RealLiteral,e)):(e=parseInt(this.source.slice(this.start,this.current),10),this.emitToken(a.DecimalLiteral,e))}catch(i){throw new x(\"Invalid decimal literal\",i)}}identifier(){for(;;){const i=this.peek();if(tr(i)||i===\"_\")this.advance();else break}let t,e=this.source.slice(this.start,this.current);switch(this.peek()){case\"%\":t=a.IntIdent,e+=this.advance();break;case\"!\":t=a.RealIdent,e+=this.advance();break;case\"?\":t=a.BoolIdent,e+=this.advance();break;case\"$\":t=a.StringIdent,e+=this.advance();break;default:ee[e]?t=ee[e]:t=a.Ident;break}return this.emitToken(t,e)}rem(){if(this.advance(),this.advance(),this.match(\" \")||this.match(\"	\")||this.peek()===`\n`||this.peek()===se){for(;this.peek()!==`\n`&&!this.done;)this.advance();const t=this.source.slice(this.start+3,this.current).trim();return this.emitToken(a.Rem,t)}else return this.identifier()}shell(){for(;!this.done;){const e=this.peek();if(Ye(e)||Ze(e))break;this.advance()}const t=this.source.slice(this.start,this.current);return this.emitToken(a.ShellToken,t)}illegal(){for(;!ir(this.peek())&&!this.done;)this.advance();const t=this.source.slice(this.start,this.current);return this.emitToken(a.Illegal,t)}}function nr(s,t){return s.lineNo-t.lineNo}function ar(s){s.sort(nr)}function ie(s,t,e,i){var r=arguments.length,n=r<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i,o;if(typeof Reflect==\"object\"&&typeof Reflect.decorate==\"function\")n=Reflect.decorate(s,t,e,i);else for(var c=s.length-1;c>=0;c--)(o=s[c])&&(n=(r<3?o(n):r>3?o(t,e,n):o(t,e))||n);return r>3&&n&&Object.defineProperty(t,e,n),n}function q(s,t){if(typeof Reflect==\"object\"&&typeof Reflect.metadata==\"function\")return Reflect.metadata(s,t)}let vt=class extends Error{constructor(){super(\"Synchronize\"),Object.setPrototypeOf(this,new.target.prototype)}};vt=ie([g(\"Synchronize\"),q(\"design:type\",Function),q(\"design:paramtypes\",[])],vt);class re{filename=\"<unknown>\";scanner;previous;current;leadingWs=\"\";next;trailingWs=\"\";lineErrors=[];errors=[];isError=!1;isWarning=!1;isProgram=!1;isLine=!1;lineNo=null;cmdNo=0;line=_.empty();isShortIf=!1;constructor(){}init(t,e,i){this.filename=e,this.scanner=new rr(t,e),this.previous=null;const[r,n]=this.nextToken();this.current=n;const[o,c]=this.nextToken();this.leadingWs=r,this.next=c,this.trailingWs=o,this.lineErrors=[],this.errors=[],this.isError=!1,this.isWarning=!1,this.isProgram=i,this.isLine=!1,this.lineNo=null,this.line=new _(r,\"\",\"\",this.current.text),this.isShortIf=!1}parseInput(t){return y(\"Parser#parseInput\",e=>{this.init(t,\"<input>\",!1);const i=new si(this.rows());let r=null;if(this.isError){const n=new R(this.errors);throw Ie(n,[\"row\",\"offsetStart\"]),n}else if(this.isWarning){const n=this.errors;r=new U(n),Ie(r,[\"row\",\"offsetStart\"])}return[i,r]})}parseProgram(t,e){return y(\"Parser#parseProgram\",i=>{this.init(t,e,!0);const r=this.rows();ar(r);const n=new Dt(this.filename,r);let o=null;if(this.isError)throw new R(this.errors);if(this.isWarning){const c=this.errors;o=new U(c)}return showTree(n),[n,o]})}match(...t){for(const e of t)if(this.check(e))return this.advance(),!0;return!1}check(t){return this.done?t===a.Eof:this.current.kind===t}checkNext(t){return this.done?t===a.Eof:this.next.kind===t}nextToken(t=\"\"){const e=this.scanner.nextToken();return e.kind===a.Whitespace?this.nextToken(t+e.text):[t,e]}advance(){this.previous=this.current,this.current=this.next,this.line.source+=this.trailingWs+this.current.text;const[t,e]=this.nextToken();return this.leadingWs=this.trailingWs,this.trailingWs=t,this.next=e,this.current.kind===a.Illegal&&this.syntaxError(this.current,`Illegal token ${this.current.text}`),this.previous}get done(){return this.current.kind==a.Eof}consume(t,e){if(this.check(t))return this.advance();this.syntaxError(this.current,e)}syntaxError(t,e){const i=new lt(e,{filename:this.filename,row:t.row,isLine:this.isLine,lineNo:this.lineNo,cmdNo:this.isLine?null:this.cmdNo,offsetStart:t.offsetStart,offsetEnd:t.offsetEnd,source:_.unknown()});throw this.isError=!0,this.lineErrors.push(i),new vt}syntaxWarning(t,e){const i=new St(e,{filename:this.filename,row:t.row,isLine:this.isLine,lineNo:this.lineNo,cmdNo:this.isLine?null:this.cmdNo,offsetStart:t.offsetStart,offsetEnd:t.offsetEnd,source:_.unknown()});this.isWarning=!0,this.lineErrors.push(i)}rows(){const t=[];for(;!this.done;){const e=this.row();e&&t.push(e)}return t}row(){const t=this.current.row;let e,i;try{this.lineNumber(),e=this.instructions(),i=this.rowEnding()}catch(r){if(r instanceof vt)return this.syncNextRow(),null;throw r}return this.lineNo!==null?new Tt(this.lineNo,t,i,e):(this.cmdNo+=10,new ei(this.cmdNo,t,i,e))}lineNumber(){const t=this.lineNo;this.match(a.DecimalLiteral)?(this.lineNo=this.previous.value,this.line.lineNo=this.previous.text,this.line.separatingWs=this.leadingWs,this.line.source=this.current.text,this.isLine=!0):this.isProgram?this.syntaxError(this.current,\"Expected line number\"):(this.lineNo=null,this.isLine=!1),this.lineNo!==null&&(this.lineNo%10&&this.syntaxWarning(this.previous,\"Line numbers should be in factors of 10\"),this.isProgram&&t!==null&&this.lineNo<=t&&this.syntaxWarning(this.previous,\"Line numbers should be in order\"))}rowEnding(){const t=this.line.clone();t.source.endsWith(`\n`)&&(t.source=t.source.slice(0,-1));for(const i of this.lineErrors)i.source=t,this.errors.push(i);if(this.lineErrors=[],!this.match(a.LineEnding)){const i=this.current;this.consume(a.Eof,`Unexpected token ${i.text.length?i.text:i.kind}`)}const e=new _(this.leadingWs,\"\",\"\",this.current.text);return this.line=e,this.isLine=!1,t}syncNextInstr(){for(;![a.Colon,a.LineEnding,a.Eof,a.Rem].includes(this.current.kind);)this.advance()}syncNextRow(){for(;![a.LineEnding,a.Eof,a.Rem].includes(this.current.kind);)this.advance();this.rowEnding()}get isLineEnding(){return this.done||this.current.kind===a.LineEnding}instructions(){if(this.isLineEnding)return[];let t=this.instruction();const e=t?[t]:[];for(;this.match(a.Colon)||this.check(a.Rem);)try{t=this.instruction(),t&&e.push(t)}catch(i){throw i instanceof vt&&this.syncNextInstr(),i}return e}instruction(){const{offsetStart:t}=this.current;let e;if(this.match(a.Rem))e=new At(this.previous.value);else if(this.match(a.Semicolon))e=new At(\"\");else if(this.match(a.Print))e=this.print();else if(this.match(a.New))e=this.new();else if(this.match(a.Load))e=this.load();else if(this.match(a.List))e=this.list();else if(this.match(a.Renum))e=this.renum();else if(this.match(a.Save))e=this.save();else if(this.match(a.Run))e=this.run();else if(this.match(a.End))e=this.end();else if(this.match(a.Exit))e=this.exit();else if(this.match(a.Let))e=this.let();else if(this.match(a.If))e=this.if_();else if(this.match(a.Else))e=this.else_();else if(this.match(a.EndIf))e=this.endIf();else if(this.match(a.For))e=this.for_();else if(this.match(a.Onward))e=this.onward();else if(this.match(a.Next))e=this.endFor();else if(this.match(a.While))e=this.while_();else if(this.match(a.EndWhile))e=this.endWhile();else if(this.match(a.Repeat))e=this.repeat();else if(this.match(a.Until))e=this.until();else{const r=this.assign();r?e=r:this.checkExpressionStatementStart()?e=this.expressionStatement():e=this.command()}const{offsetEnd:i}=this.previous;return e.offsetStart=t,e.offsetEnd=i,e}print(){return new js(this.expression())}new(){return new Ws(this.optionalExpression())}load(){const t=this.params();return new Ts(t)}list(){if(this.match(a.DecimalLiteral)){const t=this.previous.value;if(this.match(a.Minus)){const e=this.consume(a.DecimalLiteral,\"Expected line end\").value;return new Wt(t,e)}return new Wt(t,null)}return new Wt(null,null)}renum(){return new Ds}save(){return new Js(this.optionalExpression())}run(){return new Us}end(){return new As}exit(){const t=this.optionalExpression();return t?new ge(t):new ge(null)}expressionStatement(){return new Fs(this.expression())}let(){let t;this.match(a.IntIdent,a.RealIdent,a.BoolIdent,a.StringIdent)?t=this.variable():this.syntaxError(this.current,\"Expected variable name\");let e=null;return this.match(a.Eq)&&(e=this.expression()),new Os(t,e)}assign(){if((this.check(a.IntIdent)||this.check(a.RealIdent)||this.check(a.BoolIdent)||this.check(a.StringIdent))&&this.checkNext(a.Eq)){this.advance();const t=this.variable();this.consume(a.Eq,\"Expected =\");const e=this.expression();return new Bs(t,e)}return null}if_(){const t=this.ifCondition();return!this.isShortIf&&this.isLineEnding?new Cs(t):this.shortIf(t)}ifCondition(){const t=this.expression();return this.consume(a.Then,\"Expected then\"),t}shortIf(t){const e=this.isShortIf;this.isShortIf=!0;const i=this.instructions();let r=[];return this.match(a.Else)&&(r=this.instructions()),this.consume(a.EndIf,\"Expected 'endif' after 'if' instruction\"),this.isShortIf=e,new Gs(t,i,r)}else_(){return this.isShortIf&&this.syntaxError(this.previous,\"Unexpected 'else'\"),this.match(a.If)?this.elseIf():new zs}elseIf(){return new Hs(this.ifCondition())}endIf(){return this.isShortIf&&this.syntaxError(this.previous,\"Unexpected 'endif'\"),new Ms}for_(){const t=this.assign();t||this.syntaxError(this.previous,\"Expected assignment\"),this.consume(a.To,\"Expected 'to'\");const e=this.expression();let i=null;return this.match(a.Step)&&(i=this.expression()),new qs(t.variable,t.value,e,i)}onward(){return new Vs}endFor(){return new Zs}while_(){const t=this.expression();return new Xs(t)}endWhile(){return new Ys}repeat(){return new Qs}until(){const t=this.expression();return new Ks(t)}checkPrimaryStart(){return this.check(a.DecimalLiteral)||this.check(a.HexLiteral)||this.check(a.OctalLiteral)||this.check(a.BinaryLiteral)||this.check(a.RealLiteral)||this.check(a.TrueLiteral)||this.check(a.FalseLiteral)||this.check(a.StringLiteral)||this.check(a.NilLiteral)||this.check(a.IntIdent)||this.check(a.RealIdent)||this.check(a.BoolIdent)||this.check(a.StringIdent)||this.check(a.LParen)}checkExpressionStatementStart(){return this.checkPrimaryStart()||[...Object.values(ee),a.Plus,a.Minus].reduce((t,e)=>this.check(e)||t,!1)}command(){const t=this.param();if(!t){const i=this.current;this.syntaxError(i,`Unexpected token ${i.text.length?i.text:i.kind}`)}const e=this.params();return new ti(t,e)}optionalExpression(){for(const t of[a.Colon,a.LineEnding,a.Eof])if(this.check(t))return null;return this.expression()}expression(){return this.or()}infixOperator(t,e,i){let r=e();for(;this.match(...t);){const n=this.previous.kind,o=e();r=i(r,n,o)}return r}prefixOperator(t,e,i){const r=this.prefixOperator.bind(this,t,e,i);if(this.match(...t)){const n=this.previous.kind,o=r();return i(n,o)}return e()}or(){return this.infixOperator([a.Or],this.and.bind(this),(t,e,i)=>new me(t,e,i))}and(){return this.infixOperator([a.And],this.not.bind(this),(t,e,i)=>new me(t,e,i))}not(){return this.prefixOperator([a.Not],this.equality.bind(this),(t,e)=>new pe(t,e))}equality(){return this.infixOperator([a.Eq,a.EqEq,a.BangEq,a.Ne],this.comparison.bind(this),(t,e,i)=>(e==a.Eq?(this.syntaxWarning(this.previous,\"Use `==` instead of `==` for equality\"),e=a.EqEq):e==a.BangEq&&(this.syntaxWarning(this.previous,\"Use `<>` instead of `!=` for equality\"),e=a.Ne),new tt(t,e,i)))}comparison(){return this.infixOperator([a.Gt,a.Ge,a.Lt,a.Le],this.term.bind(this),(t,e,i)=>new tt(t,e,i))}term(){return this.infixOperator([a.Minus,a.Plus],this.factor.bind(this),(t,e,i)=>new tt(t,e,i))}factor(){return this.infixOperator([a.Slash,a.Star],this.unary.bind(this),(t,e,i)=>new tt(t,e,i))}unary(){return this.prefixOperator([a.Minus,a.Plus],this.primary.bind(this),(t,e)=>new pe(t,e))}primary(){if(this.match(a.DecimalLiteral,a.HexLiteral,a.OctalLiteral,a.BinaryLiteral))return new jt(this.previous.value);if(this.match(a.RealLiteral))return new Ns(this.previous.value);if(this.match(a.TrueLiteral))return new de(!0);if(this.match(a.FalseLiteral))return new de(!1);if(this.match(a.StringLiteral))return this.string();if(this.match(a.NilLiteral))return new Ps;if(this.match(a.IntIdent,a.RealIdent,a.BoolIdent,a.StringIdent))return this.variable();if(this.match(a.LParen))return this.group();{const t=this.current;let e=`Unexpected token ${t.text.length?t.text:t.kind}`;t.kind==a.UnterminatedStringLiteral&&(e=`Unterminated string ${t.text}`),this.syntaxError(t,e)}}variable(){return new Ls(this.previous)}group(){const t=this.expression();return this.consume(a.RParen,\"Expected `)` after expression\"),new Ss(t)}string(){return new Rs(this.parseStringEscapeCodes(!1))}prompt(){return new $s(this.parseStringEscapeCodes(!0))}parseStringEscapeCodes(t){const e=[],i=this.previous.text,r=this.previous.value;let n=\"\",o=1;function c(){return o++,r[o-1]}function u(){return o>=r.length-1}for(;!u();){const m=c();if(m===\"\\\\\"){const p=c();switch(p){case\"a\":n+=\"\\x07\";break;case\"b\":n+=\"\\b\";break;case\"e\":n+=\"\\x1B\";break;case\"t\":t?n+=\"\\\\t\":n+=\"	\";break;case\"r\":n+=\"\\r\";break;case\"v\":n+=\"\\v\";break;case\"f\":n+=\"\\f\";break;case\"n\":n+=`\n`;break;case\"'\":case'\"':n+=p;break;case\"\\\\\":n+=\"\\\\\";break;default:e.push(new St(`Invalid escape sequence \\`\\\\${p}\\``,{filename:this.filename,row:this.current.row,isLine:this.isLine,lineNo:this.lineNo,cmdNo:this.isLine?null:this.cmdNo,offsetStart:this.previous.offsetStart+o-2,offsetEnd:this.previous.offsetStart+o,source:_.unknown()})),this.isWarning=!0,n+=\"\\\\\",n+=p}}else n+=m}for(const m of e)m.message+=` in string ${i}`,this.lineErrors.push(m),this.isWarning=!0;return n}params(){const t=[];let e=this.param();for(;e;)t.push(e),e=this.param();return t}param(){return this.checkPrimaryStart()?this.primary():this.shellLiteral()}shellLiteral(){let[t,e]=this.matchShellPart();if(!t)return null;let i=\"\";for(;t&&(i+=this.previous.text,!e);)[t,e]=this.matchShellPart();return new _s(i)}checkShellPart(){return this.check(a.Rem)||this.check(a.LineEnding)||this.check(a.Eof)?!1:!this.current.text.match(/[`#$&*()|[\\]{}:'\"<>?!]+/)}matchShellPart(){return this.checkShellPart()?(this.advance(),[!0,!!this.leadingWs.length]):[!1,!!this.trailingWs.length]}}ie([qt,q(\"design:type\",Function),q(\"design:paramtypes\",[String]),q(\"design:returntype\",typeof ParseResult>\"u\"?Object:ParseResult)],re.prototype,\"parseInput\",null),ie([qt,q(\"design:type\",Function),q(\"design:paramtypes\",[String,String]),q(\"design:returntype\",typeof ParseResult>\"u\"?Object:ParseResult)],re.prototype,\"parseProgram\",null);class Qe{stack=[];push(t){this.stack.push(t)}pop(){const t=this.stack.pop();return xt.notEqual(typeof t,\"undefined\",\"Popped empty stack\"),t}peek(t=0){return this.empty?null:this.stack[this.stack.length-t-1]}set(t,e){this.stack[t]=e}get empty(){return this.stack.length===0}get size(){return this.stack.length}reset(){this.stack=[]}format(t){return t.formatStack(this)}}class or{next;filename;lineNo;constructor(t,e,i){this.next=t,this.filename=e,this.lineNo=i}format(t){return t.formatTraceback(this)}}function Ke(s,t=h.Any){switch(t===h.Any&&(t=J(s)),t){case h.Integer:case h.Real:return s===0;case h.Boolean:return!s;case h.String:return!s.length;case h.Exception:return!1;case h.Nil:case h.Undef:return!0;default:throw new D(`Cannot determine if ${S.format(s)} is truthy`,s,t,h.Boolean)}}function b(s,t,e){throw new D(`Cannot cast ${t} to ${e}`,s,t,e)}function Q(s,t,e){try{b(s,t,e)}catch(i){throw new x(`Cannot cast ${t} to ${e}`,i)}}function cr(s,t){switch(t){case h.Integer:return s;case h.Real:return s;case h.Boolean:return!!s;case h.String:return b(s,h.Integer,h.String);case h.Exception:return b(s,h.Integer,h.Exception);case h.Nil:return b(s,h.Integer,h.Nil)}return Q(s,h.Integer,h.Unknown)}function hr(s,t){switch(t){case h.Integer:return Math.floor(s);case h.Real:return s;case h.Boolean:return!!s;case h.String:return b(s,h.Real,h.String);case h.Exception:return b(s,h.Real,h.Exception);case h.Nil:return b(s,h.Real,h.Nil)}return Q(s,h.Real,h.Unknown)}function lr(s,t){switch(t){case h.Integer:return 1;case h.Real:return 1;case h.Boolean:return s;case h.String:return b(s,h.Boolean,h.String);case h.Exception:return b(s,h.Boolean,h.Exception);case h.Nil:return b(s,h.Boolean,h.Nil)}return Q(s,h.Boolean,h.Unknown)}function ur(s,t){switch(t){case h.Integer:return b(s,h.String,h.Integer);case h.Real:return b(s,h.String,h.Real);case h.Boolean:return!!s.length;case h.String:return s;case h.Exception:return b(s,h.String,h.Exception);case h.Nil:return b(s,h.String,h.Nil)}return Q(s,h.String,h.Unknown)}function fr(s,t){switch(t){case h.Integer:return b(s,h.Exception,h.Integer);case h.Real:return b(s,h.Exception,h.Real);case h.Boolean:return!0;case h.String:return b(s,h.Exception,h.String);case h.Exception:return s;case h.Nil:return b(s,h.Exception,h.Nil)}return Q(s,h.Exception,h.Unknown)}function ts(s,t){switch(t){case h.Integer:return b(s,h.Nil,h.Integer);case h.Real:return b(s,h.Nil,h.Integer);case h.Boolean:return!1;case h.String:return b(s,h.Nil,h.String);case h.Exception:return b(s,h.Nil,h.Exception);case h.Nil:return s}return Q(s,h.Nil,h.Unknown)}function es(s,t,e){switch(t===h.Any&&(t=J(s)),t){case h.Integer:return cr(s,e);case h.Real:return hr(s,e);case h.Boolean:return lr(s,e);case h.String:return ur(s,e);case h.Exception:return fr(s,e);case h.Nil:return ts(s,e);case h.Undef:return ts(z,e);default:return Q(s,h.Unknown,h.Unknown)}}function pr(s,t,e,i){var r=arguments.length,n=r<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i,o;if(typeof Reflect==\"object\"&&typeof Reflect.decorate==\"function\")n=Reflect.decorate(s,t,e,i);else for(var c=s.length-1;c>=0;c--)(o=s[c])&&(n=(r<3?o(n):r>3?o(t,e,n):o(t,e))||n);return r>3&&n&&Object.defineProperty(t,e,n),n}function ss(s,t){if(typeof Reflect==\"object\"&&typeof Reflect.metadata==\"function\")return Reflect.metadata(s,t)}function is(s){switch(s){case h.Boolean:return 0;case h.Integer:return 1;case h.Real:return 2;case h.String:return 3;default:return 4}}function mr(s,t){return is(s)>is(t)?s:t}let st=class extends Error{constructor(){super(\"Invalid\"),Object.setPrototypeOf(this,new.target.prototype)}};st=pr([g(\"Invalid\"),ss(\"design:type\",Function),ss(\"design:paramtypes\",[])],st);function B(){throw new st}function $t(s){return function(e,i){const r=J(e),n=J(i),o=mr(r,n),c=es(e,r,o),u=es(i,n,o);let m;try{switch(o){case h.Boolean:m=\"boolean\";break;case h.Integer:m=\"integer\";break;case h.Real:m=\"real\";break;case h.String:m=\"string\";break;default:B()}return s.check&&s.check(e,r,c,i,n,u,o),s[m](c,u)}catch(p){throw p instanceof st?new D(`Invalid operand for ${s.name} on ${r}: ${n}`,i,n,h.Invalid):p}}}function dr(s){return function(e){const i=J(e);try{switch(i){case h.Boolean:return s.boolean(e);case h.Integer:return s.integer(e);case h.Real:return s.real(e);case h.String:return s.string(e);default:B()}}catch(r){throw r instanceof st?new D(`Invalid operand for ${s.name}: ${i}`,e,i,h.Invalid):r}}}function it(s){return function(e,i){const r=J(e),n=J(i);try{if(r!=n)return s.any(e,r,i,n);switch(r){case h.Boolean:return s.boolean(e,i);case h.Integer:return s.integer(e,i);case h.Real:return s.real(e,i);case h.String:return s.string(e,i);default:B()}}catch(o){throw o instanceof st?new D(`Invalid operand for ${s.name} on ${r}: ${n}`,i,n,h.Invalid):o}}}const gr=$t({name:\"+\",boolean:(s,t)=>s?t?2:1:t?1:0,integer:(s,t)=>s+t,real:(s,t)=>s+t,string:(s,t)=>s+t}),wr=$t({name:\"-\",boolean:(s,t)=>s?t?0:1:t?-1:0,integer:(s,t)=>s-t,real:(s,t)=>s-t,string:(s,t)=>B()}),vr=$t({name:\"*\",boolean:(s,t)=>s&&t,integer:(s,t)=>s*t,real:(s,t)=>s*t,string:(s,t)=>B()}),br=$t({name:\"/\",check:(s,t,e,i,r,n,o)=>{if(!n)throw new Gt(s,t,i,r)},boolean:(s,t)=>s?1:0,integer:(s,t)=>s/t,real:(s,t)=>s/t,string:(s,t)=>B()}),yr=dr({name:\"-\",boolean:s=>s?-1:0,integer:s=>-s,real:s=>-s,string:s=>B()}),Er=it({name:\"==\",any:(s,t,e,i)=>!1,boolean:(s,t)=>s===t,integer:(s,t)=>s===t,real:(s,t)=>s===t,string:(s,t)=>s===t}),Ir=it({name:\"<>\",any:(s,t,e,i)=>!0,boolean:(s,t)=>s!==t,integer:(s,t)=>s!==t,real:(s,t)=>s!==t,string:(s,t)=>s!==t}),xr=it({name:\">\",any:(s,t,e,i)=>B(),boolean:(s,t)=>s>t,integer:(s,t)=>s>t,real:(s,t)=>s>t,string:(s,t)=>s>t}),kr=it({name:\">=\",any:(s,t,e,i)=>B(),boolean:(s,t)=>s>=t,integer:(s,t)=>s>=t,real:(s,t)=>s>=t,string:(s,t)=>s>=t}),Sr=it({name:\"<\",any:(s,t,e,i)=>B(),boolean:(s,t)=>s<t,integer:(s,t)=>s<t,real:(s,t)=>s<t,string:(s,t)=>s<t}),Lr=it({name:\"<=\",any:(s,t,e,i)=>B(),boolean:(s,t)=>s<=t,integer:(s,t)=>s<=t,real:(s,t)=>s<=t,string:(s,t)=>s<=t});function Nr(s){const t=J(s);try{return Ke(s,t)}catch(e){throw e instanceof D?new D(`Invalid operand for not: ${t}`,s,t,h.Invalid):e}}class Rr{host;executor;stack;pc=-1;chunk=new Kt;globals={};constructor(t,e){this.host=t,this.executor=e,this.stack=new Qe}reset(){this.stack=new Qe,this.chunk=new Kt,this.pc=0}async using(t){const e=this.chunk,i=this.pc,r=await t();return this.chunk=e,this.pc=i,r}async interpret(t){return this.chunk=t,this.pc=0,await this.run()}readByte(){const t=this.chunk.code[this.pc];return this.pc++,t}readCode(){return this.readByte()}readConstant(){return this.chunk.constants[this.readByte()]}readShort(){return Le([this.readByte(),this.readByte()])}readString(){const t=this.readConstant();return xt.equal(typeof t,\"string\",\"Value is string\"),t}createTraceback(){return new or(null,this.chunk.filename,this.chunk.lines[this.pc-1])}async command(){const t=[];let e=this.readByte();for(;e>1;)t.unshift(this.stack.pop()),e--;const i=this.stack.pop();await this.executor.command(i,t)}async run(){return y(\"Runtime#run\",async t=>{let e=null,i=null;try{for(;;){const r=this.readCode();switch(r){case l.Constant:this.stack.push(this.readConstant());break;case l.Nil:this.stack.push(z);break;case l.Undef:this.stack.push(Pe);break;case l.True:this.stack.push(!0);break;case l.False:this.stack.push(!1);break;case l.Pop:this.stack.pop();break;case l.GetLocal:e=this.readByte(),this.stack.push(this.stack.peek(e));break;case l.SetLocal:e=this.readByte(),this.stack.set(e,this.stack.peek());break;case l.GetGlobal:if(e=this.readString(),i=this.globals[e],typeof i>\"u\")throw new ht(`Variable ${e} is undefined`);this.stack.push(i);break;case l.DefineGlobal:if(e=this.readString(),i=this.stack.peek(),typeof this.globals[e]<\"u\")throw new ht(`Cannot define variable ${e} twice`);this.globals[e]=i,this.stack.pop();break;case l.SetGlobal:if(e=this.readString(),i=this.stack.peek(),typeof this.globals[e]>\"u\")throw new ht(`Cannot assign to undefined variable ${e}`);this.globals[e]=i;break;case l.Eq:i=this.stack.pop(),e=this.stack.pop(),this.stack.push(Er(e,i));break;case l.Gt:i=this.stack.pop(),e=this.stack.pop(),this.stack.push(xr(e,i));break;case l.Ge:i=this.stack.pop(),e=this.stack.pop(),this.stack.push(kr(e,i));break;case l.Lt:i=this.stack.pop(),e=this.stack.pop(),this.stack.push(Sr(e,i));break;case l.Le:i=this.stack.pop(),e=this.stack.pop(),this.stack.push(Lr(e,i));break;case l.Ne:i=this.stack.pop(),e=this.stack.pop(),this.stack.push(Ir(e,i));break;case l.Not:e=this.stack.pop(),this.stack.push(Nr(e));break;case l.Add:i=this.stack.pop(),e=this.stack.pop(),this.stack.push(gr(e,i));break;case l.Sub:i=this.stack.pop(),e=this.stack.pop(),this.stack.push(wr(e,i));break;case l.Mul:i=this.stack.pop(),e=this.stack.pop(),this.stack.push(vr(e,i));break;case l.Div:i=this.stack.pop(),e=this.stack.pop(),this.stack.push(br(e,i));break;case l.Neg:e=this.stack.pop(),this.stack.push(yr(e));break;case l.Print:this.host.writeLine(this.stack.pop());break;case l.Exit:return e=this.stack.pop(),typeof e==\"number\"?i=Math.floor(e):pt(e)?i=0:e?i=1:i=0,this.host.exit(i),Pe;case l.Command:await this.command();break;case l.Jump:e=this.readShort(),this.pc+=e;break;case l.JumpIfFalse:e=this.readShort(),i=this.stack.peek(),Ke(i)&&(this.pc+=e);break;case l.Loop:e=this.readShort(),this.pc-=e;break;case l.Return:return e=this.stack.pop(),e;default:xt.ok(this.pc<this.chunk.code.length,\"Program counter out of bounds\"),this.notImplemented(`Unknown opcode: ${r}`)}}}catch(r){let n=r;throw r instanceof W?r:(r instanceof T||(n=x.fromError(r)),n.traceback=this.createTraceback(),n)}})}notImplemented(t){throw new Ct(t)}}const _r=Bt.version.split(\".\").slice(0,2).join(\".\");let ne=null;const rs=new Set(\"01234567\".split(\"\")),$r=6;function ns(s,t){return ne===null&&(ne=new RegExp(`^${t.homedir()}`)),s.replace(ne,\"~\")}class Pr{ps1;historyFileSize;host;constructor(t,e,i){this.ps1=t,this.historyFileSize=e,this.host=i}render(t){let e=\"\",i=0,r=null;const n=()=>{const u=r||this.host.now();return r=u,u},o=()=>(i++,this.ps1[i-1]),c=()=>i>=this.ps1.length;for(;i<this.ps1.length;){const u=o();if(u===\"\\\\\"){if(c())return e+\"\\\\\";const m=o();let p=\"\",E=null;switch(m){case\"d\":e+=K(\"%a %b %d\",n());break;case\"D\":if(this.ps1[i]!==\"{\"){e+=`\\\\D${o()}`;break}for(o();!c()&&this.ps1[i]!==\"}\";)p+=o();c()||o(),p.length||(p=\"%H:%M:%S\"),e+=K(p,n());break;case\"h\":e+=this.host.hostname().split(\".\")[0];break;case\"H\":e+=this.host.hostname();break;case\"j\":e+=\"0\";break;case\"l\":E=this.host.tty(),E?e+=ce(E):e+=\"cons0\";break;case\"s\":e+=this.host.shell();break;case\"t\":e+=K(\"%H:%M:%S\",n());break;case\"T\":e+=K(\"%I:%M:%S\",n());break;case\"@\":e+=K(\"%I:%M %p\",n());break;case\"A\":e+=K(\"%H:%M\",n());break;case\"u\":e+=this.host.username();break;case\"v\":e+=_r;break;case\"V\":e+=Bt.version;break;case\"w\":e+=ns(this.host.cwd,this.host);break;case\"W\":e+=ns(ce(this.host.cwd),this.host);break;case\"!\":e+=t+this.historyFileSize+1;break;case\"#\":e+=t+1;break;case\"$\":e+=this.host.uid()===0?\"#\":\"$\";break;case\"\\\\\":e+=\"\\\\\";break;case\"[\":case\"]\":break;default:if(rs.has(m)){let d=m,f=1;for(;rs.has(this.ps1[i])&&f<$r;)d+=o(),f++;if(d.length<3){e+=`\\\\${d}`;break}const $=parseInt(d,8);e+=String.fromCharCode($);break}e+=`\\\\${m}`}}else e+=u}return e}}function Or(s,t,e,i){var r=arguments.length,n=r<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i,o;if(typeof Reflect==\"object\"&&typeof Reflect.decorate==\"function\")n=Reflect.decorate(s,t,e,i);else for(var c=s.length-1;c>=0;c--)(o=s[c])&&(n=(r<3?o(n):r>3?o(t,e,n):o(t,e))||n);return r>3&&n&&Object.defineProperty(t,e,n),n}function as(s,t){if(typeof Reflect==\"object\"&&typeof Reflect.metadata==\"function\")return Reflect.metadata(s,t)}function Br(s,t){return function(e,i){t(e,i,s)}}class bt{config;editor;host;parser;runtime;_readline;history;ps1;cmdNo=0;interactive;commands;_deferred=[];constructor(t,e,i){this.config=t,this.editor=e,this.host=i,this.parser=new re,this.runtime=new Rr(i,this),this._readline=null,this.history=[],this.ps1=new Pr(\"\\\\u@\\\\h:\\\\w\\\\$\",this.config.historyFileSize,i),this.interactive=!1,this.commands={...Pi}}async init(){await y(\"Executor#init\",async t=>{await this.close(!1),await this.loadHistory(),this.readline=this.createInterface(),this.readline.on(\"SIGINT\",()=>{this.host.writeError(`\n`),this.host.writeDebug(\"Received SIGINT (ctrl-c)\"),this.close()}),this.readline.on(\"history\",e=>{this.history=e})})}async close(t=!0){await y(\"Executor#close\",async e=>{let i=Promise.resolve();if(this._readline){const r=this._readline;i=new Promise((n,o)=>{r.once(\"close\",()=>{n()})}),this._readline.close()}return Promise.all([i,t?this.saveHistory():Promise.resolve()]).then(()=>{})})}async using(t){await this.init();try{await t()}finally{await this.close()}}get readline(){return this._readline===null&&(this._readline=this.createInterface()),this._readline}set readline(t){this._readline=t}createInterface(){return xs.createInterface({input:this.host.inputStream,output:this.host.outputStream,terminal:!0,history:this.history,historySize:this.config.historySize})}get historyFile(){return nt.join(this.host.homedir(),\".matbas_history\")}async loadHistory(){await y(\"Executor#loadHistory\",async t=>{try{this.history=(await this.host.readFile(this.historyFile)).split(`\n`)}catch(e){e.code!==\"ENOENT\"?this.host.writeWarn(e):this.host.writeDebug(e)}})}async saveHistory(){await y(\"Executor#saveHistory\",async t=>{const e=Math.max(this.history.length-this.config.historyFileSize,0),i=this.history.slice(e);try{await this.host.writeFile(this.historyFile,i.join(`\n`))}catch(r){this.host.writeWarn(r)}})}input(t){return this.readline.question(`${t} > `)}async prompt(){const t=await this.readline.question(`${this.ps1.render(this.cmdNo)} `);return this.cmdNo++,t}defer(t){this._deferred.push(t)}async load(t){await y(\"Executor#load\",async e=>{const i=await this.host.readFile(t);let r;try{r=this.parser.parseProgram(i,this.host.resolvePath(t))}catch(c){throw c instanceof j?c:x.fromException(c)}const[n,o]=r;this.editor.program=n,this.editor.warning=o})}async run(){await y(\"Executor#run\",async t=>{const e=this.editor.program,i=this.editor.warning,r=e.filename;let n,o;try{const c=Ji(e,{filename:r});n=c[0],o=c[1]}catch(c){let u=c;if(c instanceof R&&(u=et([i,c])),u instanceof j){this.host.writeException(c);return}throw u}o=et([i,o]),o&&this.host.writeWarn(o),await this.runtime.using(async()=>{const c=this.interactive;this.interactive=!1,await this.runtime.interpret(n),this.interactive=c})})}async eval(t){await y(\"Executor#eval\",async e=>{const[i,r]=this.parser.parseInput(t),n=ai(r,\"row\");for(const o of i.input){const c=n[o.row]||null;o instanceof Tt?(c&&this.host.writeWarn(c),this.editor.setLine(o,c)):await this._eval([o,c])}this.runDeferred()})}async _eval([t,e]){let i=null;try{const r=Ui(t.instructions,{filename:\"<input>\",cmdNo:t.cmdNo,cmdSource:t.source}),n=r[0];i=r[1],i=et([e,i]),i&&this.host.writeWarn(i);const o=n.pop();for(const c of n)await this.runtime.interpret(c);if(o){const c=await this.runtime.interpret(o);c instanceof Vt||this.host.writeLine(ni.format(c))}}catch(r){let n=r;throw r instanceof R&&(n=et([e,r])),n}}async runDeferred(){for(const t of this._deferred)await t();this._deferred=[]}async command(t,e){const i=this.commands[t];if(!i)throw new O(`Unknown command ${t}`);const r=new Ii(t,this,this.host,this.interactive?this.editor:null);await i.main(r,e)}}bt=Or([rt(),Br(2,Et(\"Host\")),as(\"design:type\",Function),as(\"design:paramtypes\",[typeof A>\"u\"?Object:A,typeof wt>\"u\"?Object:wt,typeof Host>\"u\"?Object:Host])],bt);function Fr(s,t,e,i){var r=arguments.length,n=r<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i,o;if(typeof Reflect==\"object\"&&typeof Reflect.decorate==\"function\")n=Reflect.decorate(s,t,e,i);else for(var c=s.length-1;c>=0;c--)(o=s[c])&&(n=(r<3?o(n):r>3?o(t,e,n):o(t,e))||n);return r>3&&n&&Object.defineProperty(t,e,n),n}function os(s,t){if(typeof Reflect==\"object\"&&typeof Reflect.metadata==\"function\")return Reflect.metadata(s,t)}function cs(s,t){return function(e,i){t(e,i,s)}}async function jr(s,t){for(s.interactive=!0;;)await y(\"read-eval-print\",async e=>{try{const i=await s.prompt();await s.eval(i)}catch(i){if(i instanceof ft||i instanceof W)throw i;if(i instanceof T){t.writeException(i);return}throw x.fromError(i,null)}});s.interactive=!1}class Pt{host;exit;config;executor;constructor(t,e,i,r){this.host=t,this.exit=e,this.config=i,this.executor=r}async start(){const{host:t,exit:e,config:i,executor:r}=this;let n=null;t.setLevel(i.level);function o(u){e(typeof u.exitCode==\"number\"?u.exitCode:v.Software)}function c(u){hs(u,t),o(u)}process.on(\"uncaughtException\",c),process.on(\"unhandledRejection\",c);try{await r.using(async()=>{i.script?await y(\"script\",async u=>{await r.load(i.script),await r.run()}):await jr(r,t)})}catch(u){hs(u,t),n=u}if(process.removeListener(\"uncaughtException\",c),process.removeListener(\"unhandledRejection\",c),n){o(n);return}e(0)}}Pt=Fr([rt(),cs(0,Et(\"Host\")),cs(1,Et(\"exitFn\")),os(\"design:type\",Function),os(\"design:paramtypes\",[typeof Host>\"u\"?Object:Host,typeof ExitFn>\"u\"?Object:ExitFn,typeof A>\"u\"?Object:A,typeof bt>\"u\"?Object:bt])],Pt);function hs(s,t){if(s instanceof Nt&&t.writeLine(s),s instanceof W){s.message.length&&t.writeLine(s.message);return}if(s.format)try{t.writeException(s)}catch{const i=x.fromError(s,null);t.writeException(i)}else{const e=x.fromError(s,null);t.writeException(e)}}function Ar(s,t,e,i){var r=arguments.length,n=r<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i,o;if(typeof Reflect==\"object\"&&typeof Reflect.decorate==\"function\")n=Reflect.decorate(s,t,e,i);else for(var c=s.length-1;c>=0;c--)(o=s[c])&&(n=(r<3?o(n):r>3?o(t,e,n):o(t,e))||n);return r>3&&n&&Object.defineProperty(t,e,n),n}us.config();async function Wr(s){process.exit(s)}function Tr(s,t){try{return A.load(s,t)}catch(e){throw e instanceof W&&(e.message.length&&console.log(e.message),process.exit(e.exitCode)),e}}class ae{}ae=Ar([fs({providers:[{provide:\"argv\",useValue:process.argv.slice(2)},{provide:\"env\",useValue:process.env},{provide:\"exitFn\",useValue:Wr},{provide:A,useFactory:Tr,inject:[\"argv\",\"env\"]},{provide:\"Host\",useClass:Xt},wt,bt,Pt]})],ae);async function Dr(){await(await ps.createApplicationContext(ae,{})).get(Pt).start()}Dr();\n//# sourceMappingURL=main.js.map\n"

#endif
